<analysis>**original_problem_statement:**
–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –∑–∞–¥–∞—á–∞ —Å–æ—Å—Ç–æ—è–ª–∞ –≤ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –∏ –∞—É–¥–∏—Ç–µ Telegram-–±–æ—Ç–∞ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–≤–∏—Å–∞–Ω–∏–π –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ –∫–æ–¥–∞. –í —Ö–æ–¥–µ —Ä–∞–±–æ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª —Ä–∞–∑–±–∏—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–∑.

PRODUCT REQUIREMENTS:
1.  **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–º.
2.  **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í—Å–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –∫ –¥–∞–Ω–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã.
3.  **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**: –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–æ–¥—É–ª—å–Ω—ã–º, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (Repository, Service, Decorators). –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ.
4.  **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å**: –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ª–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π (prod/test) –∏ —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã (polling/webhook) —á–µ—Ä–µ–∑  —Ñ–∞–π–ª.
5.  **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø—Ä–æ—Ö–æ–¥—è—â–∏–µ —Ç–µ—Å—Ç—ã.

**User's preferred language**: –†—É—Å—Å–∫–∏–π

**what currently exists?**
–ê–≥–µ–Ω—Ç –ø—Ä–æ–≤–µ–ª –∫–æ–ª–æ—Å—Å–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º —Ä–∞–±–æ—Ç—ã –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∏–≤ –ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∫ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π, –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–π.
- **Phase 2 (Decorators)**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram () —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (, ) –¥–ª—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å–µ—Å—Å–∏—è, —Å–µ—Ä–≤–∏—Å—ã). –≠—Ç–æ —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ —É–ø—Ä–æ—Å—Ç–∏–ª–æ –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.
- **Phase 3 (Service Layer)**: –í –æ—Å–Ω–æ–≤–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ë—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å–µ—Ä–≤–∏—Å—ã (,  –∏ –¥—Ä.), –∞ —Ç–∞–∫–∂–µ —Ñ–∞–±—Ä–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤. –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±—ã–ª–∏ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º.
- **Phase 4 (Decomposition)**: –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–¥–≤–∏–Ω—É–ª–∞—Å—å. –ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π —Ñ–∞–π–ª  –±—ã–ª –¥–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞–Ω: ~42 API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –±—ã–ª–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –º–æ–¥—É–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Ä–æ—É—Ç–µ—Ä–æ–≤ ().
- **Final Architecture Push**: –ù–∞—á–∞—Ç–∞ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞–¥–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞. –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è Middleware (, , ) –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

**Last working item**:
    - Last item agent was working: –ê–≥–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏–ª—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –û–Ω —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–ª –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª —Å–ª–æ–π Middleware, –æ–±–Ω–æ–≤–∏–ª —Ñ–∞–±—Ä–∏–∫—É —Å–µ—Ä–≤–∏—Å–æ–≤, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã, –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–µ –∫–ª–∞—Å—Å—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç. –°–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –¥–æ–ª–∂–µ–Ω –±—ã–ª —Å—Ç–∞—Ç—å –ø–µ—Ä–µ–Ω–æ—Å –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è ~113 –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ .
    - Status: IN PROGRESS
    - Agent Testing Done: Y (–ê–≥–µ–Ω—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–ø—É—Å–∫–∞–ª ============================= test session starts ==============================
platform linux -- Python 3.11.14, pytest-8.4.2, pluggy-1.6.0
rootdir: /app
plugins: cov-7.0.0, asyncio-1.3.0, anyio-4.11.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 299 items

admin_notification_test.py ...                                           [  1%]
backend/tests/integration/test_order_flow_e2e.py F.FFF...                [  3%]
backend/tests/integration/test_payment_integration.py ........           [  6%]
backend/tests/integration/test_simple_integration.py ............        [ 10%]
backend/tests/integration/test_webhook_integration.py ........           [ 13%]
backend/tests/test_admin_services.py ............                        [ 17%]
backend/tests/test_api_config.py ............F.                          [ 21%]
backend/tests/test_order_service.py .......                              [ 24%]
backend/tests/test_order_utils.py ................                       [ 29%]
backend/tests/test_payment_gateway.py ..........                         [ 32%]
backend/tests/test_payment_service.py ......................             [ 40%]
backend/tests/test_refactoring_handlers.py ....                          [ 41%]
backend/tests/test_repositories.py ...........                           [ 45%]
backend/tests/test_session_manager.py .......                            [ 47%]
backend/tests/test_shipping_service.py .......................           [ 55%]
backend/tests/test_template_service.py ..................                [ 61%]
backend/tests/test_ui_components.py ...........................          [ 70%]
backend_test.py ........................................................ [ 88%]
..............                                                           [ 93%]
concurrent_test.py F                                                     [ 93%]
return_to_order_test.py ..                                               [ 94%]
telegram_bot_test.py .....                                               [ 96%]
telegram_persistence_test.py ......                                      [ 98%]
template_test.py FF..                                                    [ 99%]
test_admin_notification_direct.py F                                      [100%]

=================================== FAILURES ===================================
__________________ TestOrderFlowE2E.test_new_order_flow_basic __________________

self = <test_order_flow_e2e.TestOrderFlowE2E object at 0xf835d7808c10>
mock_update_callback = <MagicMock spec='Update' id='272910110795280'>
mock_context = <MagicMock spec='_GenericAlias' id='272910117901648'>
test_db = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.3.1', platform='asyncio')), 'telegram_shipping_bot'))

    async def test_new_order_flow_basic(
        self,
        mock_update_callback,
        mock_context,
        test_db
    ):
        """
        Test basic order flow: new_order -> addresses -> parcel -> rates
        """
        from handlers.order_flow.entry_points import new_order_start
        from handlers.order_flow.from_address import order_from_name
        from server import FROM_NAME, FROM_ADDRESS
    
        # Setup: User starts new order
        mock_update_callback.callback_query.data = "new_order"
    
        # Mock database operations
        with patch('server.find_user_by_telegram_id') as mock_find_user, \
             patch('server.count_user_templates', return_value=0), \
             patch('server.check_maintenance_mode', return_value=False), \
             patch('server.check_user_blocked', return_value=False), \
             patch('server.session_manager') as mock_session:
    
            mock_find_user.return_value = {
                "id": "user123",
                "telegram_id": 123456789,
                "balance": 100.0
            }
    
            mock_session.get_or_create_session = AsyncMock(return_value={
                "user_id": 123456789,
                "current_step": "START",
                "temp_data": {}
            })
    
            # Step 1: Start new order
            result = await new_order_start(mock_update_callback, mock_context)
    
            # Verify: Should transition to FROM_NAME state
>           assert result == FROM_NAME
E           assert -1 == 0

backend/tests/integration/test_order_flow_e2e.py:54: AssertionError
----------------------------- Captured stdout call -----------------------------
üîµ PREVIEW DATABASE: telegram_shipping_bot
üì¶ Repository Manager initialized successfully
üîµ BOT CONFIGURATION:
   Environment: TEST
   Mode: üîÑ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
‚úÖ Bot instance created: @whitelabel_shipping_bot_test_bot
------------------------------ Captured log call -------------------------------
ERROR    repositories.base_repository:base_repository.py:178 ‚ùå user_sessions.insert_one error: E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }, full error: {'index': 0, 'code': 11000, 'errmsg': 'E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }', 'keyPattern': {'user_id': 1}, 'keyValue': {'user_id': 123456789}}
ERROR    utils.handler_decorators:handler_decorators.py:44 ‚ùå Error in handler 'new_order_start' (user_id=123456789, chat_id=123456789): DuplicateKeyError: E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }, full error: {'index': 0, 'code': 11000, 'errmsg': 'E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }', 'keyPattern': {'user_id': 1}, 'keyValue': {'user_id': 123456789}}
Traceback (most recent call last):
  File "/app/backend/utils/handler_decorators.py", line 35, in wrapper
    return await func(update, context, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/utils/handler_decorators.py", line 630, in wrapper
    session = await session_repo.get_or_create_session(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/session_repository.py", line 58, in get_or_create_session
    await self.insert_one(session_data)
  File "/app/backend/repositories/base_repository.py", line 172, in insert_one
    result = await self.collection.insert_one(document)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/collection.py", line 671, in insert_one
    self._insert_one(
  File "/root/.venv/lib/python3.11/site-packages/pymongo/collection.py", line 611, in _insert_one
    self.__database.client._retryable_write(acknowledged, _insert_command, session)
  File "/root/.venv/lib/python3.11/site-packages/pymongo/mongo_client.py", line 1568, in _retryable_write
    return self._retry_with_session(retryable, func, s, None)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/mongo_client.py", line 1413, in _retry_with_session
    return self._retry_internal(retryable, func, session, bulk)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/_csot.py", line 108, in csot_wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/mongo_client.py", line 1460, in _retry_internal
    return func(session, conn, retryable)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/collection.py", line 609, in _insert_command
    _check_write_command_response(result)
  File "/root/.venv/lib/python3.11/site-packages/pymongo/helpers.py", line 259, in _check_write_command_response
    _raise_last_write_error(write_errors)
  File "/root/.venv/lib/python3.11/site-packages/pymongo/helpers.py", line 231, in _raise_last_write_error
    raise DuplicateKeyError(error.get("errmsg"), 11000, error)
pymongo.errors.DuplicateKeyError: E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }, full error: {'index': 0, 'code': 11000, 'errmsg': 'E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }', 'keyPattern': {'user_id': 1}, 'keyValue': {'user_id': 123456789}}
___________________ TestOrderFlowE2E.test_cancel_order_flow ____________________

self = <test_order_flow_e2e.TestOrderFlowE2E object at 0xf835d780a090>
mock_update_callback = <MagicMock spec='Update' id='272910102118544'>
mock_context = <MagicMock spec='_GenericAlias' id='272910102356240'>

    async def test_cancel_order_flow(
        self,
        mock_update_callback,
        mock_context
    ):
        """
        Test order cancellation
        """
        from handlers.order_flow.cancellation import cancel_order, confirm_cancel_order
        from server import SELECT_CARRIER, STATE_NAMES
    
        # Setup: User is on rates selection screen
        mock_context.user_data['last_state'] = STATE_NAMES[SELECT_CARRIER]
    
        with patch('server.safe_telegram_call') as mock_safe_call:
            mock_reply_msg = MagicMock()
            mock_reply_msg.message_id = 999
            mock_safe_call.return_value = mock_reply_msg
    
            # Step 1: User clicks cancel
            result = await cancel_order(mock_update_callback, mock_context)
    
            # Verify: Should show confirmation with "Check Data" button
>           assert result == STATE_NAMES[SELECT_CARRIER]
E           AssertionError: assert -1 == 'SELECT_CARRIER'

backend/tests/integration/test_order_flow_e2e.py:132: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    repositories.base_repository:base_repository.py:103 ‚ùå users.find_one error: Event loop is closed
ERROR    utils.handler_decorators:handler_decorators.py:44 ‚ùå Error in handler 'cancel_order' (user_id=123456789, chat_id=123456789): RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/app/backend/utils/handler_decorators.py", line 35, in wrapper
    return await func(update, context, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/utils/handler_decorators.py", line 605, in wrapper
    user = await user_repo.find_by_telegram_id(user_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/user_repository.py", line 29, in find_by_telegram_id
    return await self.find_one({"telegram_id": telegram_id})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/base_repository.py", line 94, in find_one
    result = await self.collection.find_one(filter_query, projection)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/metaprogramming.py", line 74, in method
    return framework.run_on_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/frameworks/asyncio/__init__.py", line 85, in run_on_executor
    return loop.run_in_executor(_EXECUTOR, functools.partial(fn, *args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 817, in run_in_executor
    self._check_closed()
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 520, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
_________________ TestOrderFlowE2E.test_data_confirmation_flow _________________

self = <test_order_flow_e2e.TestOrderFlowE2E object at 0xf835d780aa90>
mock_update_callback = <MagicMock spec='Update' id='272910106793168'>
mock_context = <MagicMock spec='_GenericAlias' id='272910112020880'>
sample_order_data = {'from_city': 'New York', 'from_name': 'John Doe', 'from_phone': '1234567890', 'from_state': 'NY', ...}

    async def test_data_confirmation_flow(
        self,
        mock_update_callback,
        mock_context,
        sample_order_data
    ):
        """
        Test data confirmation screen
        """
        from handlers.order_flow.confirmation import show_data_confirmation
        from server import CONFIRM_DATA
    
        # Setup: User has entered all data
        mock_context.user_data.update(sample_order_data)
    
        # Add update.message mock
        mock_update_callback.message = MagicMock()
        mock_reply_msg = MagicMock()
        mock_reply_msg.message_id = 111
        mock_update_callback.message.reply_text = AsyncMock(return_value=mock_reply_msg)
    
        with patch('server.safe_telegram_call') as mock_safe_call, \
             patch('server.session_manager') as mock_session:
    
            mock_safe_call.return_value = mock_reply_msg
            mock_session.update_session_atomic = AsyncMock()
    
            result = await show_data_confirmation(mock_update_callback, mock_context)
    
            # Verify: Should display confirmation screen
>           assert result == CONFIRM_DATA
E           assert -1 == 18

backend/tests/integration/test_order_flow_e2e.py:179: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    repositories.base_repository:base_repository.py:103 ‚ùå users.find_one error: Event loop is closed
ERROR    utils.handler_decorators:handler_decorators.py:44 ‚ùå Error in handler 'show_data_confirmation' (user_id=123456789, chat_id=123456789): RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/app/backend/utils/handler_decorators.py", line 35, in wrapper
    return await func(update, context, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/utils/handler_decorators.py", line 605, in wrapper
    user = await user_repo.find_by_telegram_id(user_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/user_repository.py", line 29, in find_by_telegram_id
    return await self.find_one({"telegram_id": telegram_id})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/base_repository.py", line 94, in find_one
    result = await self.collection.find_one(filter_query, projection)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/metaprogramming.py", line 74, in method
    return framework.run_on_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/frameworks/asyncio/__init__.py", line 85, in run_on_executor
    return loop.run_in_executor(_EXECUTOR, functools.partial(fn, *args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 817, in run_in_executor
    self._check_closed()
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 520, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
____________ TestOrderFlowE2E.test_payment_flow_sufficient_balance _____________

self = <test_order_flow_e2e.TestOrderFlowE2E object at 0xf835d780b410>
mock_update_callback = <MagicMock spec='Update' id='272910102648400'>
mock_context = <MagicMock spec='_GenericAlias' id='272910104017424'>
sample_shipping_rate = {'amount': 15.5, 'carrier': 'USPS', 'carrier_name': 'USPS', 'delivery_days': '2-3', ...}

    async def test_payment_flow_sufficient_balance(
        self,
        mock_update_callback,
        mock_context,
        sample_shipping_rate
    ):
        """
        Test payment flow when user has sufficient balance
        """
        from handlers.order_flow.payment import show_payment_methods
        from server import PAYMENT_METHOD
    
        # Setup: User selected a rate
        mock_context.user_data['selected_rate'] = sample_shipping_rate
        mock_context.user_data['final_amount'] = 15.50
    
        with patch('server.find_user_by_telegram_id') as mock_find_user, \
             patch('server.safe_telegram_call') as mock_safe_call:
    
            mock_find_user.return_value = {
                "id": "user123",
                "telegram_id": 123456789,
                "balance": 100.0  # Sufficient balance
            }
            mock_reply_msg = MagicMock()
            mock_reply_msg.message_id = 222
            mock_safe_call.return_value = mock_reply_msg
    
            result = await show_payment_methods(mock_update_callback, mock_context)
    
            # Verify: Should show balance payment option
>           assert result == PAYMENT_METHOD
E           assert -1 == 21

backend/tests/integration/test_order_flow_e2e.py:213: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    repositories.base_repository:base_repository.py:103 ‚ùå users.find_one error: Event loop is closed
ERROR    utils.handler_decorators:handler_decorators.py:44 ‚ùå Error in handler 'show_payment_methods' (user_id=123456789, chat_id=123456789): RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/app/backend/utils/handler_decorators.py", line 35, in wrapper
    return await func(update, context, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/utils/handler_decorators.py", line 605, in wrapper
    user = await user_repo.find_by_telegram_id(user_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/user_repository.py", line 29, in find_by_telegram_id
    return await self.find_one({"telegram_id": telegram_id})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/base_repository.py", line 94, in find_one
    result = await self.collection.find_one(filter_query, projection)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/metaprogramming.py", line 74, in method
    return framework.run_on_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/frameworks/asyncio/__init__.py", line 85, in run_on_executor
    return loop.run_in_executor(_EXECUTOR, functools.partial(fn, *args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 817, in run_in_executor
    self._check_closed()
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 520, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
________________ TestAPIConfigManager.test_get_all_keys_status _________________

self = <tests.test_api_config.TestAPIConfigManager object at 0xf835d691be90>

    @patch.dict(os.environ, {
        'SHIPSTATION_API_KEY_TEST': 'test_key',
        'OXAPAY_API_KEY': 'oxapay_key'
    })
    def test_get_all_keys_status(self):
        """–¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö –∫–ª—é—á–µ–π"""
        manager = APIConfigManager()
        manager.set_environment('test')
    
        status = manager.get_all_keys_status()
    
        assert status['environment'] == 'test'
        assert status['shipstation']['test_configured'] == True
>       assert status['shipstation']['prod_configured'] == False
E       assert True == False

backend/tests/test_api_config.py:182: AssertionError
___________________________ test_concurrent_requests ___________________________
async def functions are not natively supported.
You need to install a suitable plugin for your async framework, for example:
  - anyio
  - pytest-asyncio
  - pytest-tornasync
  - pytest-trio
  - pytest-twisted
_______________________ test_template_database_structure _______________________
async def functions are not natively supported.
You need to install a suitable plugin for your async framework, for example:
  - anyio
  - pytest-asyncio
  - pytest-tornasync
  - pytest-trio
  - pytest-twisted
_________________________ test_template_data_integrity _________________________
async def functions are not natively supported.
You need to install a suitable plugin for your async framework, for example:
  - anyio
  - pytest-asyncio
  - pytest-tornasync
  - pytest-trio
  - pytest-twisted
___________________________ test_admin_notification ____________________________
async def functions are not natively supported.
You need to install a suitable plugin for your async framework, for example:
  - anyio
  - pytest-asyncio
  - pytest-tornasync
  - pytest-trio
  - pytest-twisted
=============================== warnings summary ===============================
../root/.venv/lib/python3.11/site-packages/starlette/formparsers.py:12
  /root/.venv/lib/python3.11/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

admin_notification_test.py::test_admin_notification_for_label_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but admin_notification_test.py::test_admin_notification_for_label_creation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

admin_notification_test.py::test_database_collections
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but admin_notification_test.py::test_database_collections returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

admin_notification_test.py::test_backend_logs_for_notifications
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but admin_notification_test.py::test_backend_logs_for_notifications returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
  /app/backend/routers/admin/system.py:197: DeprecationWarning: `regex` has been deprecated, please use `pattern` instead
    level: str = Query("ERROR", regex="^(ALL|DEBUG|INFO|WARNING|ERROR|CRITICAL)$"),

backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
  /app/backend/server.py:6341: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
  /root/.venv/lib/python3.11/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
  /app/backend/server.py:6607: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("shutdown")

backend/tests/integration/test_payment_integration.py::TestPaymentIntegration::test_crypto_payment_invoice_creation
backend/tests/integration/test_simple_integration.py::TestAPIIntegration::test_shipstation_api_call_mocked
backend/tests/integration/test_webhook_integration.py::TestExternalAPIIntegration::test_shipstation_api_integration
backend/tests/integration/test_webhook_integration.py::TestExternalAPIIntegration::test_oxapay_payment_integration
  /root/.venv/lib/python3.11/site-packages/tenacity/asyncio/__init__.py:114: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    result = await fn(*args, **kwargs)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

backend/tests/test_refactoring_handlers.py::test_telegram_webhook_endpoint
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_refactoring_handlers.py::test_telegram_webhook_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_refactoring_handlers.py::test_admin_api_endpoints
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_refactoring_handlers.py::test_admin_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_refactoring_handlers.py::test_handlers_import_verification
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_refactoring_handlers.py::test_handlers_import_verification returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_refactoring_handlers.py::test_api_health
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_refactoring_handlers.py::test_api_health returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_api_health
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_api_health returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_monitoring_health
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_monitoring_health returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_monitoring_metrics
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_monitoring_metrics returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_carriers
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_carriers returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_shipstation_production_api_key
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_shipstation_production_api_key returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_shipstation_carrier_ids
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_shipstation_carrier_ids returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_carrier_exclusion_fix
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_carrier_exclusion_fix returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_shipping_rates_production
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_shipping_rates_production returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_shipping_rates
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_shipping_rates returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_mongodb_connection
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_mongodb_connection returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_async_operations
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_async_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_error_handling_and_retry
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_error_handling_and_retry returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_infrastructure
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_infrastructure returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_conversation_handler_functions
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_conversation_handler_functions returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_return_to_order_functionality
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_return_to_order_functionality returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_token
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_token returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_orders_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_orders_creation returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_stats_dashboard
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_stats_dashboard returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_refund_order
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_refund_order returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_export_csv
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_export_csv returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_telegram_id_environment
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_telegram_id_environment returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_notification_function
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_notification_function returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_contact_admin_buttons
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_contact_admin_buttons returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_backend_admin_id_loading
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_backend_admin_id_loading returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_admin_integration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_admin_integration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_state_names_mapping
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_state_names_mapping returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_last_state_assignments
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_last_state_assignments returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_cancel_order_state_handling
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_cancel_order_state_handling returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_return_to_order_state_restoration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_return_to_order_state_restoration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_webhook_state_simulation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_webhook_state_simulation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_webhook_endpoint
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_webhook_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_commands
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_commands returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_callback_buttons
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_callback_buttons returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_api_endpoints
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_handlers_import_verification
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_handlers_import_verification returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_session_manager_v2_migration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_session_manager_v2_migration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_mongodb_ttl_index
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_mongodb_ttl_index returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_mongodb_session_collection
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_mongodb_session_collection returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_session_cleanup_mechanism
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_session_cleanup_mechanism returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_order_creation_session_flow
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_order_creation_session_flow returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_session_cancel_order_cleanup
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_session_cancel_order_cleanup returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_refactoring_handlers_regression
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_refactoring_handlers_regression returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_webhook_status
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_webhook_status returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_webhook_environment_variables
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_webhook_environment_variables returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_webhook_logs_verification
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_webhook_logs_verification returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_double_message_bug_fix
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_double_message_bug_fix returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_template_flow_critical_issue
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_template_flow_critical_issue returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_balance_topup_flow_button_protection
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_balance_topup_flow_button_protection returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_cancel_button_functionality
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_cancel_button_functionality returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_cancel_button_conversation_states
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_cancel_button_conversation_states returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_notification_label_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_notification_label_creation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_database_collections
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_database_collections returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_backend_logs_for_notifications
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_backend_logs_for_notifications returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_notification_sending
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_notification_sending returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_help_command_implementation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_help_command_implementation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_help_infrastructure
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_help_infrastructure returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_help_command_url_generation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_help_command_url_generation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_template_based_order_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_template_based_order_creation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_check_all_bot_access
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_check_all_bot_access returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_continue_order_after_template_save
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_continue_order_after_template_save returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_template_rename_functionality
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_template_rename_functionality returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_templates_feature_use_template
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_templates_feature_use_template returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_shipping_rates
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_shipping_rates returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_help_command_formatting_improvements
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_help_command_formatting_improvements returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_order_id_length_fix
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_order_id_length_fix returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_invoice_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_invoice_creation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_payment_check
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_payment_check returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_api_configuration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_api_configuration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_webhook_success_message
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_webhook_success_message returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_atomic_operations_flow
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_atomic_operations_flow returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

return_to_order_test.py::test_critical_fix
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but return_to_order_test.py::test_critical_fix returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

return_to_order_test.py::test_scenario_simulation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but return_to_order_test.py::test_scenario_simulation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_telegram_bot_status
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_telegram_bot_status returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_telegram_webhook_endpoint
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_telegram_webhook_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_telegram_help_command
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_telegram_help_command returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_telegram_callback_buttons
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_telegram_callback_buttons returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_handlers_import
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_handlers_import returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_redis_persistence_configuration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_redis_persistence_configuration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_conversation_handler_persistence
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_conversation_handler_persistence returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_production_bot_configuration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_production_bot_configuration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_webhook_vs_polling_mode
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_webhook_vs_polling_mode returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_backend_logs_for_persistence
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_backend_logs_for_persistence returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_telegram_bot_infrastructure
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_telegram_bot_infrastructure returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

template_test.py::test_conversation_handler_registration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but template_test.py::test_conversation_handler_registration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

template_test.py::test_template_function_implementation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but template_test.py::test_template_function_implementation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
FAILED backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_cancel_order_flow
FAILED backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_data_confirmation_flow
FAILED backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_payment_flow_sufficient_balance
FAILED backend/tests/test_api_config.py::TestAPIConfigManager::test_get_all_keys_status
FAILED concurrent_test.py::test_concurrent_requests - Failed: async def funct...
FAILED template_test.py::test_template_database_structure - Failed: async def...
FAILED template_test.py::test_template_data_integrity - Failed: async def fun...
FAILED test_admin_notification_direct.py::test_admin_notification - Failed: a...
================= 9 failed, 290 passed, 102 warnings in 46.67s ================= –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∫—Ä—É–ø–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è).
    - Which testing method agent to use? backend testing agent (–ó–∞–ø—É—Å—Ç–∏—Ç—å ============================= test session starts ==============================
platform linux -- Python 3.11.14, pytest-8.4.2, pluggy-1.6.0
rootdir: /app
plugins: cov-7.0.0, asyncio-1.3.0, anyio-4.11.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 299 items

admin_notification_test.py ...                                           [  1%]
backend/tests/integration/test_order_flow_e2e.py F.FFF...                [  3%]
backend/tests/integration/test_payment_integration.py ........           [  6%]
backend/tests/integration/test_simple_integration.py ............        [ 10%]
backend/tests/integration/test_webhook_integration.py ........           [ 13%]
backend/tests/test_admin_services.py ............                        [ 17%]
backend/tests/test_api_config.py ............F.                          [ 21%]
backend/tests/test_order_service.py .......                              [ 24%]
backend/tests/test_order_utils.py ................                       [ 29%]
backend/tests/test_payment_gateway.py ..........                         [ 32%]
backend/tests/test_payment_service.py ......................             [ 40%]
backend/tests/test_refactoring_handlers.py ....                          [ 41%]
backend/tests/test_repositories.py ...........                           [ 45%]
backend/tests/test_session_manager.py .......                            [ 47%]
backend/tests/test_shipping_service.py .......................           [ 55%]
backend/tests/test_template_service.py ..................                [ 61%]
backend/tests/test_ui_components.py ...........................          [ 70%]
backend_test.py ........................................................ [ 88%]
..............                                                           [ 93%]
concurrent_test.py F                                                     [ 93%]
return_to_order_test.py ..                                               [ 94%]
telegram_bot_test.py .....                                               [ 96%]
telegram_persistence_test.py ......                                      [ 98%]
template_test.py FF..                                                    [ 99%]
test_admin_notification_direct.py F                                      [100%]

=================================== FAILURES ===================================
__________________ TestOrderFlowE2E.test_new_order_flow_basic __________________

self = <test_order_flow_e2e.TestOrderFlowE2E object at 0xf9ba7f158350>
mock_update_callback = <MagicMock spec='Update' id='274579375998800'>
mock_context = <MagicMock spec='_GenericAlias' id='274579371702032'>
test_db = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.3.1', platform='asyncio')), 'telegram_shipping_bot'))

    async def test_new_order_flow_basic(
        self,
        mock_update_callback,
        mock_context,
        test_db
    ):
        """
        Test basic order flow: new_order -> addresses -> parcel -> rates
        """
        from handlers.order_flow.entry_points import new_order_start
        from handlers.order_flow.from_address import order_from_name
        from server import FROM_NAME, FROM_ADDRESS
    
        # Setup: User starts new order
        mock_update_callback.callback_query.data = "new_order"
    
        # Mock database operations
        with patch('server.find_user_by_telegram_id') as mock_find_user, \
             patch('server.count_user_templates', return_value=0), \
             patch('server.check_maintenance_mode', return_value=False), \
             patch('server.check_user_blocked', return_value=False), \
             patch('server.session_manager') as mock_session:
    
            mock_find_user.return_value = {
                "id": "user123",
                "telegram_id": 123456789,
                "balance": 100.0
            }
    
            mock_session.get_or_create_session = AsyncMock(return_value={
                "user_id": 123456789,
                "current_step": "START",
                "temp_data": {}
            })
    
            # Step 1: Start new order
            result = await new_order_start(mock_update_callback, mock_context)
    
            # Verify: Should transition to FROM_NAME state
>           assert result == FROM_NAME
E           assert -1 == 0

backend/tests/integration/test_order_flow_e2e.py:54: AssertionError
----------------------------- Captured stdout call -----------------------------
üîµ PREVIEW DATABASE: telegram_shipping_bot
üì¶ Repository Manager initialized successfully
üîµ BOT CONFIGURATION:
   Environment: TEST
   Mode: üîÑ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
‚úÖ Bot instance created: @whitelabel_shipping_bot_test_bot
------------------------------ Captured log call -------------------------------
ERROR    repositories.base_repository:base_repository.py:178 ‚ùå user_sessions.insert_one error: E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }, full error: {'index': 0, 'code': 11000, 'errmsg': 'E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }', 'keyPattern': {'user_id': 1}, 'keyValue': {'user_id': 123456789}}
ERROR    utils.handler_decorators:handler_decorators.py:44 ‚ùå Error in handler 'new_order_start' (user_id=123456789, chat_id=123456789): DuplicateKeyError: E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }, full error: {'index': 0, 'code': 11000, 'errmsg': 'E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }', 'keyPattern': {'user_id': 1}, 'keyValue': {'user_id': 123456789}}
Traceback (most recent call last):
  File "/app/backend/utils/handler_decorators.py", line 35, in wrapper
    return await func(update, context, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/utils/handler_decorators.py", line 630, in wrapper
    session = await session_repo.get_or_create_session(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/session_repository.py", line 58, in get_or_create_session
    await self.insert_one(session_data)
  File "/app/backend/repositories/base_repository.py", line 172, in insert_one
    result = await self.collection.insert_one(document)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/collection.py", line 671, in insert_one
    self._insert_one(
  File "/root/.venv/lib/python3.11/site-packages/pymongo/collection.py", line 611, in _insert_one
    self.__database.client._retryable_write(acknowledged, _insert_command, session)
  File "/root/.venv/lib/python3.11/site-packages/pymongo/mongo_client.py", line 1568, in _retryable_write
    return self._retry_with_session(retryable, func, s, None)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/mongo_client.py", line 1413, in _retry_with_session
    return self._retry_internal(retryable, func, session, bulk)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/_csot.py", line 108, in csot_wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/mongo_client.py", line 1460, in _retry_internal
    return func(session, conn, retryable)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/collection.py", line 609, in _insert_command
    _check_write_command_response(result)
  File "/root/.venv/lib/python3.11/site-packages/pymongo/helpers.py", line 259, in _check_write_command_response
    _raise_last_write_error(write_errors)
  File "/root/.venv/lib/python3.11/site-packages/pymongo/helpers.py", line 231, in _raise_last_write_error
    raise DuplicateKeyError(error.get("errmsg"), 11000, error)
pymongo.errors.DuplicateKeyError: E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }, full error: {'index': 0, 'code': 11000, 'errmsg': 'E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }', 'keyPattern': {'user_id': 1}, 'keyValue': {'user_id': 123456789}}
___________________ TestOrderFlowE2E.test_cancel_order_flow ____________________

self = <test_order_flow_e2e.TestOrderFlowE2E object at 0xf9ba7f1596d0>
mock_update_callback = <MagicMock spec='Update' id='274579090460688'>
mock_context = <MagicMock spec='_GenericAlias' id='274579340275792'>

    async def test_cancel_order_flow(
        self,
        mock_update_callback,
        mock_context
    ):
        """
        Test order cancellation
        """
        from handlers.order_flow.cancellation import cancel_order, confirm_cancel_order
        from server import SELECT_CARRIER, STATE_NAMES
    
        # Setup: User is on rates selection screen
        mock_context.user_data['last_state'] = STATE_NAMES[SELECT_CARRIER]
    
        with patch('server.safe_telegram_call') as mock_safe_call:
            mock_reply_msg = MagicMock()
            mock_reply_msg.message_id = 999
            mock_safe_call.return_value = mock_reply_msg
    
            # Step 1: User clicks cancel
            result = await cancel_order(mock_update_callback, mock_context)
    
            # Verify: Should show confirmation with "Check Data" button
>           assert result == STATE_NAMES[SELECT_CARRIER]
E           AssertionError: assert -1 == 'SELECT_CARRIER'

backend/tests/integration/test_order_flow_e2e.py:132: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    repositories.base_repository:base_repository.py:103 ‚ùå users.find_one error: Event loop is closed
ERROR    utils.handler_decorators:handler_decorators.py:44 ‚ùå Error in handler 'cancel_order' (user_id=123456789, chat_id=123456789): RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/app/backend/utils/handler_decorators.py", line 35, in wrapper
    return await func(update, context, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/utils/handler_decorators.py", line 605, in wrapper
    user = await user_repo.find_by_telegram_id(user_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/user_repository.py", line 29, in find_by_telegram_id
    return await self.find_one({"telegram_id": telegram_id})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/base_repository.py", line 94, in find_one
    result = await self.collection.find_one(filter_query, projection)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/metaprogramming.py", line 74, in method
    return framework.run_on_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/frameworks/asyncio/__init__.py", line 85, in run_on_executor
    return loop.run_in_executor(_EXECUTOR, functools.partial(fn, *args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 817, in run_in_executor
    self._check_closed()
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 520, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
_________________ TestOrderFlowE2E.test_data_confirmation_flow _________________

self = <test_order_flow_e2e.TestOrderFlowE2E object at 0xf9ba7f15a0d0>
mock_update_callback = <MagicMock spec='Update' id='274579090881744'>
mock_context = <MagicMock spec='_GenericAlias' id='274579128359248'>
sample_order_data = {'from_city': 'New York', 'from_name': 'John Doe', 'from_phone': '1234567890', 'from_state': 'NY', ...}

    async def test_data_confirmation_flow(
        self,
        mock_update_callback,
        mock_context,
        sample_order_data
    ):
        """
        Test data confirmation screen
        """
        from handlers.order_flow.confirmation import show_data_confirmation
        from server import CONFIRM_DATA
    
        # Setup: User has entered all data
        mock_context.user_data.update(sample_order_data)
    
        # Add update.message mock
        mock_update_callback.message = MagicMock()
        mock_reply_msg = MagicMock()
        mock_reply_msg.message_id = 111
        mock_update_callback.message.reply_text = AsyncMock(return_value=mock_reply_msg)
    
        with patch('server.safe_telegram_call') as mock_safe_call, \
             patch('server.session_manager') as mock_session:
    
            mock_safe_call.return_value = mock_reply_msg
            mock_session.update_session_atomic = AsyncMock()
    
            result = await show_data_confirmation(mock_update_callback, mock_context)
    
            # Verify: Should display confirmation screen
>           assert result == CONFIRM_DATA
E           assert -1 == 18

backend/tests/integration/test_order_flow_e2e.py:179: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    repositories.base_repository:base_repository.py:103 ‚ùå users.find_one error: Event loop is closed
ERROR    utils.handler_decorators:handler_decorators.py:44 ‚ùå Error in handler 'show_data_confirmation' (user_id=123456789, chat_id=123456789): RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/app/backend/utils/handler_decorators.py", line 35, in wrapper
    return await func(update, context, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/utils/handler_decorators.py", line 605, in wrapper
    user = await user_repo.find_by_telegram_id(user_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/user_repository.py", line 29, in find_by_telegram_id
    return await self.find_one({"telegram_id": telegram_id})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/base_repository.py", line 94, in find_one
    result = await self.collection.find_one(filter_query, projection)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/metaprogramming.py", line 74, in method
    return framework.run_on_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/frameworks/asyncio/__init__.py", line 85, in run_on_executor
    return loop.run_in_executor(_EXECUTOR, functools.partial(fn, *args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 817, in run_in_executor
    self._check_closed()
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 520, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
____________ TestOrderFlowE2E.test_payment_flow_sufficient_balance _____________

self = <test_order_flow_e2e.TestOrderFlowE2E object at 0xf9ba7f15aa50>
mock_update_callback = <MagicMock spec='Update' id='274579090456080'>
mock_context = <MagicMock spec='_GenericAlias' id='274579090447312'>
sample_shipping_rate = {'amount': 15.5, 'carrier': 'USPS', 'carrier_name': 'USPS', 'delivery_days': '2-3', ...}

    async def test_payment_flow_sufficient_balance(
        self,
        mock_update_callback,
        mock_context,
        sample_shipping_rate
    ):
        """
        Test payment flow when user has sufficient balance
        """
        from handlers.order_flow.payment import show_payment_methods
        from server import PAYMENT_METHOD
    
        # Setup: User selected a rate
        mock_context.user_data['selected_rate'] = sample_shipping_rate
        mock_context.user_data['final_amount'] = 15.50
    
        with patch('server.find_user_by_telegram_id') as mock_find_user, \
             patch('server.safe_telegram_call') as mock_safe_call:
    
            mock_find_user.return_value = {
                "id": "user123",
                "telegram_id": 123456789,
                "balance": 100.0  # Sufficient balance
            }
            mock_reply_msg = MagicMock()
            mock_reply_msg.message_id = 222
            mock_safe_call.return_value = mock_reply_msg
    
            result = await show_payment_methods(mock_update_callback, mock_context)
    
            # Verify: Should show balance payment option
>           assert result == PAYMENT_METHOD
E           assert -1 == 21

backend/tests/integration/test_order_flow_e2e.py:213: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    repositories.base_repository:base_repository.py:103 ‚ùå users.find_one error: Event loop is closed
ERROR    utils.handler_decorators:handler_decorators.py:44 ‚ùå Error in handler 'show_payment_methods' (user_id=123456789, chat_id=123456789): RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/app/backend/utils/handler_decorators.py", line 35, in wrapper
    return await func(update, context, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/utils/handler_decorators.py", line 605, in wrapper
    user = await user_repo.find_by_telegram_id(user_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/user_repository.py", line 29, in find_by_telegram_id
    return await self.find_one({"telegram_id": telegram_id})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/base_repository.py", line 94, in find_one
    result = await self.collection.find_one(filter_query, projection)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/metaprogramming.py", line 74, in method
    return framework.run_on_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/frameworks/asyncio/__init__.py", line 85, in run_on_executor
    return loop.run_in_executor(_EXECUTOR, functools.partial(fn, *args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 817, in run_in_executor
    self._check_closed()
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 520, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
________________ TestAPIConfigManager.test_get_all_keys_status _________________

self = <tests.test_api_config.TestAPIConfigManager object at 0xf9ba7de58990>

    @patch.dict(os.environ, {
        'SHIPSTATION_API_KEY_TEST': 'test_key',
        'OXAPAY_API_KEY': 'oxapay_key'
    })
    def test_get_all_keys_status(self):
        """–¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö –∫–ª—é—á–µ–π"""
        manager = APIConfigManager()
        manager.set_environment('test')
    
        status = manager.get_all_keys_status()
    
        assert status['environment'] == 'test'
        assert status['shipstation']['test_configured'] == True
>       assert status['shipstation']['prod_configured'] == False
E       assert True == False

backend/tests/test_api_config.py:182: AssertionError
___________________________ test_concurrent_requests ___________________________
async def functions are not natively supported.
You need to install a suitable plugin for your async framework, for example:
  - anyio
  - pytest-asyncio
  - pytest-tornasync
  - pytest-trio
  - pytest-twisted
_______________________ test_template_database_structure _______________________
async def functions are not natively supported.
You need to install a suitable plugin for your async framework, for example:
  - anyio
  - pytest-asyncio
  - pytest-tornasync
  - pytest-trio
  - pytest-twisted
_________________________ test_template_data_integrity _________________________
async def functions are not natively supported.
You need to install a suitable plugin for your async framework, for example:
  - anyio
  - pytest-asyncio
  - pytest-tornasync
  - pytest-trio
  - pytest-twisted
___________________________ test_admin_notification ____________________________
async def functions are not natively supported.
You need to install a suitable plugin for your async framework, for example:
  - anyio
  - pytest-asyncio
  - pytest-tornasync
  - pytest-trio
  - pytest-twisted
=============================== warnings summary ===============================
../root/.venv/lib/python3.11/site-packages/starlette/formparsers.py:12
  /root/.venv/lib/python3.11/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

admin_notification_test.py::test_admin_notification_for_label_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but admin_notification_test.py::test_admin_notification_for_label_creation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

admin_notification_test.py::test_database_collections
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but admin_notification_test.py::test_database_collections returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

admin_notification_test.py::test_backend_logs_for_notifications
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but admin_notification_test.py::test_backend_logs_for_notifications returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
  /app/backend/routers/admin/system.py:197: DeprecationWarning: `regex` has been deprecated, please use `pattern` instead
    level: str = Query("ERROR", regex="^(ALL|DEBUG|INFO|WARNING|ERROR|CRITICAL)$"),

backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
  /app/backend/server.py:6341: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
  /root/.venv/lib/python3.11/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
  /app/backend/server.py:6607: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("shutdown")

backend/tests/integration/test_payment_integration.py::TestPaymentIntegration::test_crypto_payment_invoice_creation
backend/tests/integration/test_simple_integration.py::TestAPIIntegration::test_shipstation_api_call_mocked
backend/tests/integration/test_webhook_integration.py::TestExternalAPIIntegration::test_shipstation_api_integration
backend/tests/integration/test_webhook_integration.py::TestExternalAPIIntegration::test_oxapay_payment_integration
  /root/.venv/lib/python3.11/site-packages/tenacity/asyncio/__init__.py:114: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    result = await fn(*args, **kwargs)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

backend/tests/test_refactoring_handlers.py::test_telegram_webhook_endpoint
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_refactoring_handlers.py::test_telegram_webhook_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_refactoring_handlers.py::test_admin_api_endpoints
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_refactoring_handlers.py::test_admin_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_refactoring_handlers.py::test_handlers_import_verification
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_refactoring_handlers.py::test_handlers_import_verification returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_refactoring_handlers.py::test_api_health
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_refactoring_handlers.py::test_api_health returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_api_health
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_api_health returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_monitoring_health
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_monitoring_health returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_monitoring_metrics
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_monitoring_metrics returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_carriers
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_carriers returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_shipstation_production_api_key
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_shipstation_production_api_key returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_shipstation_carrier_ids
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_shipstation_carrier_ids returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_carrier_exclusion_fix
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_carrier_exclusion_fix returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_shipping_rates_production
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_shipping_rates_production returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_shipping_rates
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_shipping_rates returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_mongodb_connection
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_mongodb_connection returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_async_operations
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_async_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_error_handling_and_retry
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_error_handling_and_retry returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_infrastructure
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_infrastructure returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_conversation_handler_functions
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_conversation_handler_functions returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_return_to_order_functionality
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_return_to_order_functionality returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_token
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_token returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_orders_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_orders_creation returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_stats_dashboard
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_stats_dashboard returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_refund_order
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_refund_order returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_export_csv
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_export_csv returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_telegram_id_environment
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_telegram_id_environment returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_notification_function
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_notification_function returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_contact_admin_buttons
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_contact_admin_buttons returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_backend_admin_id_loading
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_backend_admin_id_loading returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_admin_integration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_admin_integration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_state_names_mapping
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_state_names_mapping returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_last_state_assignments
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_last_state_assignments returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_cancel_order_state_handling
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_cancel_order_state_handling returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_return_to_order_state_restoration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_return_to_order_state_restoration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_webhook_state_simulation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_webhook_state_simulation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_webhook_endpoint
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_webhook_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_commands
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_commands returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_callback_buttons
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_callback_buttons returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_api_endpoints
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_handlers_import_verification
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_handlers_import_verification returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_session_manager_v2_migration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_session_manager_v2_migration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_mongodb_ttl_index
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_mongodb_ttl_index returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_mongodb_session_collection
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_mongodb_session_collection returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_session_cleanup_mechanism
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_session_cleanup_mechanism returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_order_creation_session_flow
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_order_creation_session_flow returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_session_cancel_order_cleanup
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_session_cancel_order_cleanup returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_refactoring_handlers_regression
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_refactoring_handlers_regression returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_webhook_status
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_webhook_status returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_webhook_environment_variables
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_webhook_environment_variables returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_webhook_logs_verification
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_webhook_logs_verification returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_double_message_bug_fix
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_double_message_bug_fix returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_template_flow_critical_issue
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_template_flow_critical_issue returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_balance_topup_flow_button_protection
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_balance_topup_flow_button_protection returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_cancel_button_functionality
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_cancel_button_functionality returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_cancel_button_conversation_states
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_cancel_button_conversation_states returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_notification_label_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_notification_label_creation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_database_collections
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_database_collections returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_backend_logs_for_notifications
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_backend_logs_for_notifications returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_notification_sending
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_notification_sending returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_help_command_implementation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_help_command_implementation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_help_infrastructure
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_help_infrastructure returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_help_command_url_generation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_help_command_url_generation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_template_based_order_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_template_based_order_creation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_check_all_bot_access
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_check_all_bot_access returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_continue_order_after_template_save
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_continue_order_after_template_save returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_template_rename_functionality
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_template_rename_functionality returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_templates_feature_use_template
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_templates_feature_use_template returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_shipping_rates
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_shipping_rates returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_help_command_formatting_improvements
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_help_command_formatting_improvements returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_order_id_length_fix
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_order_id_length_fix returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_invoice_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_invoice_creation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_payment_check
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_payment_check returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_api_configuration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_api_configuration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_webhook_success_message
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_webhook_success_message returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_atomic_operations_flow
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_atomic_operations_flow returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

return_to_order_test.py::test_critical_fix
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but return_to_order_test.py::test_critical_fix returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

return_to_order_test.py::test_scenario_simulation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but return_to_order_test.py::test_scenario_simulation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_telegram_bot_status
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_telegram_bot_status returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_telegram_webhook_endpoint
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_telegram_webhook_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_telegram_help_command
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_telegram_help_command returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_telegram_callback_buttons
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_telegram_callback_buttons returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_handlers_import
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_handlers_import returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_redis_persistence_configuration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_redis_persistence_configuration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_conversation_handler_persistence
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_conversation_handler_persistence returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_production_bot_configuration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_production_bot_configuration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_webhook_vs_polling_mode
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_webhook_vs_polling_mode returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_backend_logs_for_persistence
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_backend_logs_for_persistence returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_telegram_bot_infrastructure
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_telegram_bot_infrastructure returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

template_test.py::test_conversation_handler_registration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but template_test.py::test_conversation_handler_registration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

template_test.py::test_template_function_implementation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but template_test.py::test_template_function_implementation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
FAILED backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_cancel_order_flow
FAILED backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_data_confirmation_flow
FAILED backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_payment_flow_sufficient_balance
FAILED backend/tests/test_api_config.py::TestAPIConfigManager::test_get_all_keys_status
FAILED concurrent_test.py::test_concurrent_requests - Failed: async def funct...
FAILED template_test.py::test_template_database_structure - Failed: async def...
FAILED template_test.py::test_template_data_integrity - Failed: async def fun...
FAILED test_admin_notification_direct.py::test_admin_notification - Failed: a...
================= 9 failed, 290 passed, 102 warnings in 32.16s ================= –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ç–µ—Å—Ç–æ–≤ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞).
    - User Testing Done: N

**All Pending/In progress Issue list**:
  - Issue 1: (P0) 5 –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤.
  
  Issues Detail:
  - Issue 1: 
     - Attempted fixes: –ê–≥–µ–Ω—Ç –æ–ø—Ä–µ–¥–µ–ª–∏–ª, —á—Ç–æ 2 —Ç–µ—Å—Ç–∞ —è–≤–ª—è—é—Ç—Å—è –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ flaky —Ç–µ—Å—Ç–∞–º–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–µ—Å—Å–∏–π. 3 –¥—Ä—É–≥–∏—Ö —Ç–µ—Å—Ç–∞ (,  –∏ –¥—Ä. –≤ ) –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑-–∑–∞ –º–∞—Å—à—Ç–∞–±–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (–≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤). –ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –º–æ–∫–∏ –≤ —ç—Ç–∏—Ö —Ç–µ—Å—Ç–∞—Ö —É—Å—Ç–∞—Ä–µ–ª–∏ –∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.
     - Next debug checklist: 
        1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞–¥–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã –≤  –∏  –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ.
        2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ —Ç–µ—Å—Ç–æ–≤ –∏ –∫–æ–¥ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.
        3. –û–±–Ω–æ–≤–∏—Ç—å –º–æ–∫–∏ () –≤ —Ç–µ—Å—Ç–∞—Ö, —á—Ç–æ–±—ã –æ–Ω–∏ –º–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –º–µ—Ç–æ–¥—ã —Å–µ—Ä–≤–∏—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ), –∞ –Ω–µ —Å—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –º–µ—Ç–æ–¥—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤.
        4. –û—Ç–¥–µ–ª—å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å –¥–≤—É–º—è flaky —Ç–µ—Å—Ç–∞–º–∏ ( –∏ ), –ø—Ä–æ–≤–µ—Ä–∏–≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏.
     - Why fix this issue and what will be achieved with the fix? –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ 100% –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –¥–∞–ª—å–Ω–µ–π—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏.
     - Status:  NOT STARTED
     - Is recurring issue? Y (2 —Ç–µ—Å—Ç–∞ —è–≤–ª—è—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º–∏—Å—è)
     - Should Test frontend/backend/both after fix? backend
     - Blocked on other issue: –ù–µ—Ç.

**In progress Task List**:
  - Task 1: (P0) –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ Phase 4: –ü–æ–ª–Ω–∞—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è .

 Task Detail:
  - Task 1: 
     - Where to resume: 
        1. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è ~113 —Ñ—É–Ω–∫—Ü–∏–π –≤ .
        2. –°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏, –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è Telegram, –ª–æ–≥–∏–∫–∞, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –¥–ª—è –¥–æ–º–µ–Ω–∞).
        3. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–ª–∏ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏  (–Ω–∞–ø—Ä–∏–º–µ—Ä, , ) –∏–ª–∏, –µ—Å–ª–∏ —ç—Ç–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã –≤ .
        4. –£–¥–∞–ª–∏—Ç—å –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑  –∏ –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ, —á—Ç–æ–±—ã –æ–Ω–∏ —É–∫–∞–∑—ã–≤–∞–ª–∏ –Ω–∞ –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.
     - What will be achieved with this? –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–Ω–æ–ª–∏—Ç–∞ , –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –µ–≥–æ –≤ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–æ—É—Ç–µ—Ä–æ–≤ –∏ middleware. –≠—Ç–æ —Å–¥–µ–ª–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —á–∏—Å—Ç–æ–π, –º–æ–¥—É–ª—å–Ω–æ–π –∏ –≥–æ—Ç–æ–≤–æ–π –∫ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é.
     - Status:  IN PROGRESS
     - Should Test frontend/backend/both after fix? backend
     - Blocked on something: –ù–µ—Ç.

**Upcoming and Future Tasks**
 Upcoming Tasks:
    - (P1) **Phase 5: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**. –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ middleware FastAPI –¥–ª—è –±–æ–ª–µ–µ —á–∏—Å—Ç–æ–≥–æ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞.
 Future Tasks:
    - –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ Redis.
    - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (JSON) —á–µ—Ä–µ–∑ logging middleware.
    - –£–ª—É—á—à–µ–Ω–∏–µ CI/CD.

**Completed work in this session**
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–π**: –£—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 2 –Ω–æ–≤—ã—Ö —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–∞, –≤–æ–∑–Ω–∏–∫—à–∏—Ö –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∞–≥–µ–Ω—Ç–∞.
- **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ Phase 2 (Handler Decorators)**: –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –∫–æ –í–°–ï–ú –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º Telegram –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö –≤ , —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–≤ –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–µ—Ä–≤–∏—Å–æ–≤.
- **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ Phase 3 (Service Layer Integration)**: –°–æ–∑–¥–∞–Ω–∞ —Ñ–∞–±—Ä–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤, –∏ –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±—ã–ª–∏ –æ—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è, —á—Ç–æ –æ—Ç–¥–µ–ª–∏–ª–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –æ—Ç –ª–æ–≥–∏–∫–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.
- **–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ Phase 4 (Decomposition)**: –£—Å–ø–µ—à–Ω–æ –≤—ã–Ω–µ—Å–µ–Ω–æ ~42 API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –∏–∑  –≤ 11 –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Ä–æ—É—Ç–µ—Ä–æ–≤ (orders, users, shipping, bot, stats –∏ —Ç.–¥.).
- **–°–æ–∑–¥–∞–Ω–∏–µ Middleware Layer**: –ó–∞–ª–æ–∂–µ–Ω–∞ –æ—Å–Ω–æ–≤–∞ –¥–ª—è middleware, —Å–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã –¥–ª—è , ,  –∏ –æ–Ω–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: –°–æ–∑–¥–∞–Ω –∏ –æ–±–Ω–æ–≤–ª—è–ª—Å—è —Ñ–∞–π–ª .

**Earlier issues found/mentioned but not fixed**
   - Issue 1: 5 –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤ (2 flaky –∏ 3 –∏–∑-–∑–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –º–æ–∫–æ–≤). –û–ø–∏—Å–∞–Ω—ã –≤ —Å–µ–∫—Ü–∏–∏ .

**Code Architecture**


**Key Technical Concepts**
- Async Everywhere (, )
- Architectural Patterns: Repository, Service Layer, Service Factory, Advanced Decorators
- Dependency Injection: –ß–µ—Ä–µ–∑ FastAPI  –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
- Middleware (FastAPI)
- Modular Routing (FastAPI APIRouter)
- Environment Configuration (/)
- Testing (============================= test session starts ==============================
platform linux -- Python 3.11.14, pytest-8.4.2, pluggy-1.6.0
rootdir: /app
plugins: cov-7.0.0, asyncio-1.3.0, anyio-4.11.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 299 items

admin_notification_test.py ...                                           [  1%]
backend/tests/integration/test_order_flow_e2e.py F.FFF...                [  3%]
backend/tests/integration/test_payment_integration.py ........           [  6%]
backend/tests/integration/test_simple_integration.py ............        [ 10%]
backend/tests/integration/test_webhook_integration.py ........           [ 13%]
backend/tests/test_admin_services.py ............                        [ 17%]
backend/tests/test_api_config.py ............F.                          [ 21%]
backend/tests/test_order_service.py .......                              [ 24%]
backend/tests/test_order_utils.py ................                       [ 29%]
backend/tests/test_payment_gateway.py ..........                         [ 32%]
backend/tests/test_payment_service.py ......................             [ 40%]
backend/tests/test_refactoring_handlers.py ....                          [ 41%]
backend/tests/test_repositories.py ...........                           [ 45%]
backend/tests/test_session_manager.py .......                            [ 47%]
backend/tests/test_shipping_service.py .......................           [ 55%]
backend/tests/test_template_service.py ..................                [ 61%]
backend/tests/test_ui_components.py ...........................          [ 70%]
backend_test.py ........................................................ [ 88%]
..............                                                           [ 93%]
concurrent_test.py F                                                     [ 93%]
return_to_order_test.py ..                                               [ 94%]
telegram_bot_test.py .....                                               [ 96%]
telegram_persistence_test.py ......                                      [ 98%]
template_test.py FF..                                                    [ 99%]
test_admin_notification_direct.py F                                      [100%]

=================================== FAILURES ===================================
__________________ TestOrderFlowE2E.test_new_order_flow_basic __________________

self = <test_order_flow_e2e.TestOrderFlowE2E object at 0xfe109cea8190>
mock_update_callback = <MagicMock spec='Update' id='279347283840976'>
mock_context = <MagicMock spec='_GenericAlias' id='279347283813456'>
test_db = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.3.1', platform='asyncio')), 'telegram_shipping_bot'))

    async def test_new_order_flow_basic(
        self,
        mock_update_callback,
        mock_context,
        test_db
    ):
        """
        Test basic order flow: new_order -> addresses -> parcel -> rates
        """
        from handlers.order_flow.entry_points import new_order_start
        from handlers.order_flow.from_address import order_from_name
        from server import FROM_NAME, FROM_ADDRESS
    
        # Setup: User starts new order
        mock_update_callback.callback_query.data = "new_order"
    
        # Mock database operations
        with patch('server.find_user_by_telegram_id') as mock_find_user, \
             patch('server.count_user_templates', return_value=0), \
             patch('server.check_maintenance_mode', return_value=False), \
             patch('server.check_user_blocked', return_value=False), \
             patch('server.session_manager') as mock_session:
    
            mock_find_user.return_value = {
                "id": "user123",
                "telegram_id": 123456789,
                "balance": 100.0
            }
    
            mock_session.get_or_create_session = AsyncMock(return_value={
                "user_id": 123456789,
                "current_step": "START",
                "temp_data": {}
            })
    
            # Step 1: Start new order
            result = await new_order_start(mock_update_callback, mock_context)
    
            # Verify: Should transition to FROM_NAME state
>           assert result == FROM_NAME
E           assert -1 == 0

backend/tests/integration/test_order_flow_e2e.py:54: AssertionError
----------------------------- Captured stdout call -----------------------------
üîµ PREVIEW DATABASE: telegram_shipping_bot
üì¶ Repository Manager initialized successfully
üîµ BOT CONFIGURATION:
   Environment: TEST
   Mode: üîÑ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
‚úÖ Bot instance created: @whitelabel_shipping_bot_test_bot
------------------------------ Captured log call -------------------------------
ERROR    repositories.base_repository:base_repository.py:178 ‚ùå user_sessions.insert_one error: E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }, full error: {'index': 0, 'code': 11000, 'errmsg': 'E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }', 'keyPattern': {'user_id': 1}, 'keyValue': {'user_id': 123456789}}
ERROR    utils.handler_decorators:handler_decorators.py:44 ‚ùå Error in handler 'new_order_start' (user_id=123456789, chat_id=123456789): DuplicateKeyError: E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }, full error: {'index': 0, 'code': 11000, 'errmsg': 'E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }', 'keyPattern': {'user_id': 1}, 'keyValue': {'user_id': 123456789}}
Traceback (most recent call last):
  File "/app/backend/utils/handler_decorators.py", line 35, in wrapper
    return await func(update, context, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/utils/handler_decorators.py", line 630, in wrapper
    session = await session_repo.get_or_create_session(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/session_repository.py", line 58, in get_or_create_session
    await self.insert_one(session_data)
  File "/app/backend/repositories/base_repository.py", line 172, in insert_one
    result = await self.collection.insert_one(document)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/collection.py", line 671, in insert_one
    self._insert_one(
  File "/root/.venv/lib/python3.11/site-packages/pymongo/collection.py", line 611, in _insert_one
    self.__database.client._retryable_write(acknowledged, _insert_command, session)
  File "/root/.venv/lib/python3.11/site-packages/pymongo/mongo_client.py", line 1568, in _retryable_write
    return self._retry_with_session(retryable, func, s, None)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/mongo_client.py", line 1413, in _retry_with_session
    return self._retry_internal(retryable, func, session, bulk)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/_csot.py", line 108, in csot_wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/mongo_client.py", line 1460, in _retry_internal
    return func(session, conn, retryable)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/pymongo/collection.py", line 609, in _insert_command
    _check_write_command_response(result)
  File "/root/.venv/lib/python3.11/site-packages/pymongo/helpers.py", line 259, in _check_write_command_response
    _raise_last_write_error(write_errors)
  File "/root/.venv/lib/python3.11/site-packages/pymongo/helpers.py", line 231, in _raise_last_write_error
    raise DuplicateKeyError(error.get("errmsg"), 11000, error)
pymongo.errors.DuplicateKeyError: E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }, full error: {'index': 0, 'code': 11000, 'errmsg': 'E11000 duplicate key error collection: telegram_shipping_bot.user_sessions index: user_id_1 dup key: { user_id: 123456789 }', 'keyPattern': {'user_id': 1}, 'keyValue': {'user_id': 123456789}}
___________________ TestOrderFlowE2E.test_cancel_order_flow ____________________

self = <test_order_flow_e2e.TestOrderFlowE2E object at 0xfe109cea95d0>
mock_update_callback = <MagicMock spec='Update' id='279346869785232'>
mock_context = <MagicMock spec='_GenericAlias' id='279347246016400'>

    async def test_cancel_order_flow(
        self,
        mock_update_callback,
        mock_context
    ):
        """
        Test order cancellation
        """
        from handlers.order_flow.cancellation import cancel_order, confirm_cancel_order
        from server import SELECT_CARRIER, STATE_NAMES
    
        # Setup: User is on rates selection screen
        mock_context.user_data['last_state'] = STATE_NAMES[SELECT_CARRIER]
    
        with patch('server.safe_telegram_call') as mock_safe_call:
            mock_reply_msg = MagicMock()
            mock_reply_msg.message_id = 999
            mock_safe_call.return_value = mock_reply_msg
    
            # Step 1: User clicks cancel
            result = await cancel_order(mock_update_callback, mock_context)
    
            # Verify: Should show confirmation with "Check Data" button
>           assert result == STATE_NAMES[SELECT_CARRIER]
E           AssertionError: assert -1 == 'SELECT_CARRIER'

backend/tests/integration/test_order_flow_e2e.py:132: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    repositories.base_repository:base_repository.py:103 ‚ùå users.find_one error: Event loop is closed
ERROR    utils.handler_decorators:handler_decorators.py:44 ‚ùå Error in handler 'cancel_order' (user_id=123456789, chat_id=123456789): RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/app/backend/utils/handler_decorators.py", line 35, in wrapper
    return await func(update, context, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/utils/handler_decorators.py", line 605, in wrapper
    user = await user_repo.find_by_telegram_id(user_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/user_repository.py", line 29, in find_by_telegram_id
    return await self.find_one({"telegram_id": telegram_id})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/base_repository.py", line 94, in find_one
    result = await self.collection.find_one(filter_query, projection)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/metaprogramming.py", line 74, in method
    return framework.run_on_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/frameworks/asyncio/__init__.py", line 85, in run_on_executor
    return loop.run_in_executor(_EXECUTOR, functools.partial(fn, *args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 817, in run_in_executor
    self._check_closed()
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 520, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
_________________ TestOrderFlowE2E.test_data_confirmation_flow _________________

self = <test_order_flow_e2e.TestOrderFlowE2E object at 0xfe109cea9fd0>
mock_update_callback = <MagicMock spec='Update' id='279347243560080'>
mock_context = <MagicMock spec='_GenericAlias' id='279347246018704'>
sample_order_data = {'from_city': 'New York', 'from_name': 'John Doe', 'from_phone': '1234567890', 'from_state': 'NY', ...}

    async def test_data_confirmation_flow(
        self,
        mock_update_callback,
        mock_context,
        sample_order_data
    ):
        """
        Test data confirmation screen
        """
        from handlers.order_flow.confirmation import show_data_confirmation
        from server import CONFIRM_DATA
    
        # Setup: User has entered all data
        mock_context.user_data.update(sample_order_data)
    
        # Add update.message mock
        mock_update_callback.message = MagicMock()
        mock_reply_msg = MagicMock()
        mock_reply_msg.message_id = 111
        mock_update_callback.message.reply_text = AsyncMock(return_value=mock_reply_msg)
    
        with patch('server.safe_telegram_call') as mock_safe_call, \
             patch('server.session_manager') as mock_session:
    
            mock_safe_call.return_value = mock_reply_msg
            mock_session.update_session_atomic = AsyncMock()
    
            result = await show_data_confirmation(mock_update_callback, mock_context)
    
            # Verify: Should display confirmation screen
>           assert result == CONFIRM_DATA
E           assert -1 == 18

backend/tests/integration/test_order_flow_e2e.py:179: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    repositories.base_repository:base_repository.py:103 ‚ùå users.find_one error: Event loop is closed
ERROR    utils.handler_decorators:handler_decorators.py:44 ‚ùå Error in handler 'show_data_confirmation' (user_id=123456789, chat_id=123456789): RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/app/backend/utils/handler_decorators.py", line 35, in wrapper
    return await func(update, context, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/utils/handler_decorators.py", line 605, in wrapper
    user = await user_repo.find_by_telegram_id(user_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/user_repository.py", line 29, in find_by_telegram_id
    return await self.find_one({"telegram_id": telegram_id})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/base_repository.py", line 94, in find_one
    result = await self.collection.find_one(filter_query, projection)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/metaprogramming.py", line 74, in method
    return framework.run_on_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/frameworks/asyncio/__init__.py", line 85, in run_on_executor
    return loop.run_in_executor(_EXECUTOR, functools.partial(fn, *args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 817, in run_in_executor
    self._check_closed()
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 520, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
____________ TestOrderFlowE2E.test_payment_flow_sufficient_balance _____________

self = <test_order_flow_e2e.TestOrderFlowE2E object at 0xfe109ceaa950>
mock_update_callback = <MagicMock spec='Update' id='279346869789200'>
mock_context = <MagicMock spec='_GenericAlias' id='279346869783632'>
sample_shipping_rate = {'amount': 15.5, 'carrier': 'USPS', 'carrier_name': 'USPS', 'delivery_days': '2-3', ...}

    async def test_payment_flow_sufficient_balance(
        self,
        mock_update_callback,
        mock_context,
        sample_shipping_rate
    ):
        """
        Test payment flow when user has sufficient balance
        """
        from handlers.order_flow.payment import show_payment_methods
        from server import PAYMENT_METHOD
    
        # Setup: User selected a rate
        mock_context.user_data['selected_rate'] = sample_shipping_rate
        mock_context.user_data['final_amount'] = 15.50
    
        with patch('server.find_user_by_telegram_id') as mock_find_user, \
             patch('server.safe_telegram_call') as mock_safe_call:
    
            mock_find_user.return_value = {
                "id": "user123",
                "telegram_id": 123456789,
                "balance": 100.0  # Sufficient balance
            }
            mock_reply_msg = MagicMock()
            mock_reply_msg.message_id = 222
            mock_safe_call.return_value = mock_reply_msg
    
            result = await show_payment_methods(mock_update_callback, mock_context)
    
            # Verify: Should show balance payment option
>           assert result == PAYMENT_METHOD
E           assert -1 == 21

backend/tests/integration/test_order_flow_e2e.py:213: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    repositories.base_repository:base_repository.py:103 ‚ùå users.find_one error: Event loop is closed
ERROR    utils.handler_decorators:handler_decorators.py:44 ‚ùå Error in handler 'show_payment_methods' (user_id=123456789, chat_id=123456789): RuntimeError: Event loop is closed
Traceback (most recent call last):
  File "/app/backend/utils/handler_decorators.py", line 35, in wrapper
    return await func(update, context, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/utils/handler_decorators.py", line 605, in wrapper
    user = await user_repo.find_by_telegram_id(user_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/user_repository.py", line 29, in find_by_telegram_id
    return await self.find_one({"telegram_id": telegram_id})
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/repositories/base_repository.py", line 94, in find_one
    result = await self.collection.find_one(filter_query, projection)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/metaprogramming.py", line 74, in method
    return framework.run_on_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.venv/lib/python3.11/site-packages/motor/frameworks/asyncio/__init__.py", line 85, in run_on_executor
    return loop.run_in_executor(_EXECUTOR, functools.partial(fn, *args, **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 817, in run_in_executor
    self._check_closed()
  File "/usr/local/lib/python3.11/asyncio/base_events.py", line 520, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
________________ TestAPIConfigManager.test_get_all_keys_status _________________

self = <tests.test_api_config.TestAPIConfigManager object at 0xfe109bba8490>

    @patch.dict(os.environ, {
        'SHIPSTATION_API_KEY_TEST': 'test_key',
        'OXAPAY_API_KEY': 'oxapay_key'
    })
    def test_get_all_keys_status(self):
        """–¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö –∫–ª—é—á–µ–π"""
        manager = APIConfigManager()
        manager.set_environment('test')
    
        status = manager.get_all_keys_status()
    
        assert status['environment'] == 'test'
        assert status['shipstation']['test_configured'] == True
>       assert status['shipstation']['prod_configured'] == False
E       assert True == False

backend/tests/test_api_config.py:182: AssertionError
___________________________ test_concurrent_requests ___________________________
async def functions are not natively supported.
You need to install a suitable plugin for your async framework, for example:
  - anyio
  - pytest-asyncio
  - pytest-tornasync
  - pytest-trio
  - pytest-twisted
_______________________ test_template_database_structure _______________________
async def functions are not natively supported.
You need to install a suitable plugin for your async framework, for example:
  - anyio
  - pytest-asyncio
  - pytest-tornasync
  - pytest-trio
  - pytest-twisted
_________________________ test_template_data_integrity _________________________
async def functions are not natively supported.
You need to install a suitable plugin for your async framework, for example:
  - anyio
  - pytest-asyncio
  - pytest-tornasync
  - pytest-trio
  - pytest-twisted
___________________________ test_admin_notification ____________________________
async def functions are not natively supported.
You need to install a suitable plugin for your async framework, for example:
  - anyio
  - pytest-asyncio
  - pytest-tornasync
  - pytest-trio
  - pytest-twisted
=============================== warnings summary ===============================
../root/.venv/lib/python3.11/site-packages/starlette/formparsers.py:12
  /root/.venv/lib/python3.11/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

admin_notification_test.py::test_admin_notification_for_label_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but admin_notification_test.py::test_admin_notification_for_label_creation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

admin_notification_test.py::test_database_collections
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but admin_notification_test.py::test_database_collections returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

admin_notification_test.py::test_backend_logs_for_notifications
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but admin_notification_test.py::test_backend_logs_for_notifications returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
  /app/backend/routers/admin/system.py:197: DeprecationWarning: `regex` has been deprecated, please use `pattern` instead
    level: str = Query("ERROR", regex="^(ALL|DEBUG|INFO|WARNING|ERROR|CRITICAL)$"),

backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
  /app/backend/server.py:6341: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
  /root/.venv/lib/python3.11/site-packages/fastapi/applications.py:4495: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
  /app/backend/server.py:6607: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("shutdown")

backend/tests/integration/test_payment_integration.py::TestPaymentIntegration::test_crypto_payment_invoice_creation
backend/tests/integration/test_simple_integration.py::TestAPIIntegration::test_shipstation_api_call_mocked
backend/tests/integration/test_webhook_integration.py::TestExternalAPIIntegration::test_shipstation_api_integration
backend/tests/integration/test_webhook_integration.py::TestExternalAPIIntegration::test_oxapay_payment_integration
  /root/.venv/lib/python3.11/site-packages/tenacity/asyncio/__init__.py:114: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    result = await fn(*args, **kwargs)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

backend/tests/test_refactoring_handlers.py::test_telegram_webhook_endpoint
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_refactoring_handlers.py::test_telegram_webhook_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_refactoring_handlers.py::test_admin_api_endpoints
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_refactoring_handlers.py::test_admin_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_refactoring_handlers.py::test_handlers_import_verification
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_refactoring_handlers.py::test_handlers_import_verification returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend/tests/test_refactoring_handlers.py::test_api_health
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend/tests/test_refactoring_handlers.py::test_api_health returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_api_health
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_api_health returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_monitoring_health
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_monitoring_health returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_monitoring_metrics
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_monitoring_metrics returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_carriers
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_carriers returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_shipstation_production_api_key
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_shipstation_production_api_key returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_shipstation_carrier_ids
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_shipstation_carrier_ids returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_carrier_exclusion_fix
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_carrier_exclusion_fix returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_shipping_rates_production
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_shipping_rates_production returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_shipping_rates
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_shipping_rates returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_mongodb_connection
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_mongodb_connection returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_async_operations
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_async_operations returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_error_handling_and_retry
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_error_handling_and_retry returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_infrastructure
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_infrastructure returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_conversation_handler_functions
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_conversation_handler_functions returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_return_to_order_functionality
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_return_to_order_functionality returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_token
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_token returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_orders_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_orders_creation returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_stats_dashboard
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_stats_dashboard returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_refund_order
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_refund_order returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_export_csv
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_export_csv returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_telegram_id_environment
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_telegram_id_environment returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_notification_function
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_notification_function returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_contact_admin_buttons
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_contact_admin_buttons returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_backend_admin_id_loading
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_backend_admin_id_loading returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_admin_integration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_admin_integration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_state_names_mapping
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_state_names_mapping returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_last_state_assignments
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_last_state_assignments returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_cancel_order_state_handling
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_cancel_order_state_handling returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_return_to_order_state_restoration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_return_to_order_state_restoration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_webhook_state_simulation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_webhook_state_simulation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_webhook_endpoint
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_webhook_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_commands
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_commands returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_callback_buttons
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_callback_buttons returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_api_endpoints
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_api_endpoints returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_handlers_import_verification
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_handlers_import_verification returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_session_manager_v2_migration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_session_manager_v2_migration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_mongodb_ttl_index
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_mongodb_ttl_index returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_mongodb_session_collection
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_mongodb_session_collection returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_session_cleanup_mechanism
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_session_cleanup_mechanism returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_order_creation_session_flow
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_order_creation_session_flow returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_session_cancel_order_cleanup
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_session_cancel_order_cleanup returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_refactoring_handlers_regression
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_refactoring_handlers_regression returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_webhook_status
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_webhook_status returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_webhook_environment_variables
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_webhook_environment_variables returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_webhook_logs_verification
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_webhook_logs_verification returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_double_message_bug_fix
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_double_message_bug_fix returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_template_flow_critical_issue
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_template_flow_critical_issue returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_balance_topup_flow_button_protection
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_balance_topup_flow_button_protection returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_cancel_button_functionality
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_cancel_button_functionality returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_cancel_button_conversation_states
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_cancel_button_conversation_states returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_notification_label_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_notification_label_creation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_database_collections
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_database_collections returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_backend_logs_for_notifications
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_backend_logs_for_notifications returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_admin_notification_sending
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_admin_notification_sending returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_help_command_implementation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_help_command_implementation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_help_infrastructure
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_help_infrastructure returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_help_command_url_generation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_help_command_url_generation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_template_based_order_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_template_based_order_creation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_check_all_bot_access
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_check_all_bot_access returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_continue_order_after_template_save
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_continue_order_after_template_save returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_template_rename_functionality
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_template_rename_functionality returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_templates_feature_use_template
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_templates_feature_use_template returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_telegram_bot_shipping_rates
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_telegram_bot_shipping_rates returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_help_command_formatting_improvements
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_help_command_formatting_improvements returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_order_id_length_fix
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_order_id_length_fix returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_invoice_creation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_invoice_creation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_payment_check
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_payment_check returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_api_configuration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_api_configuration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_oxapay_webhook_success_message
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_oxapay_webhook_success_message returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

backend_test.py::test_atomic_operations_flow
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but backend_test.py::test_atomic_operations_flow returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

return_to_order_test.py::test_critical_fix
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but return_to_order_test.py::test_critical_fix returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

return_to_order_test.py::test_scenario_simulation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but return_to_order_test.py::test_scenario_simulation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_telegram_bot_status
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_telegram_bot_status returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_telegram_webhook_endpoint
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_telegram_webhook_endpoint returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_telegram_help_command
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_telegram_help_command returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_telegram_callback_buttons
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_telegram_callback_buttons returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_bot_test.py::test_handlers_import
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_bot_test.py::test_handlers_import returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_redis_persistence_configuration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_redis_persistence_configuration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_conversation_handler_persistence
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_conversation_handler_persistence returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_production_bot_configuration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_production_bot_configuration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_webhook_vs_polling_mode
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_webhook_vs_polling_mode returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_backend_logs_for_persistence
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_backend_logs_for_persistence returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

telegram_persistence_test.py::test_telegram_bot_infrastructure
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but telegram_persistence_test.py::test_telegram_bot_infrastructure returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

template_test.py::test_conversation_handler_registration
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but template_test.py::test_conversation_handler_registration returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

template_test.py::test_template_function_implementation
  /root/.venv/lib/python3.11/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but template_test.py::test_template_function_implementation returned <class 'bool'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_new_order_flow_basic
FAILED backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_cancel_order_flow
FAILED backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_data_confirmation_flow
FAILED backend/tests/integration/test_order_flow_e2e.py::TestOrderFlowE2E::test_payment_flow_sufficient_balance
FAILED backend/tests/test_api_config.py::TestAPIConfigManager::test_get_all_keys_status
FAILED concurrent_test.py::test_concurrent_requests - Failed: async def funct...
FAILED template_test.py::test_template_database_structure - Failed: async def...
FAILED template_test.py::test_template_data_integrity - Failed: async def fun...
FAILED test_admin_notification_direct.py::test_admin_notification - Failed: a...
================= 9 failed, 290 passed, 102 warnings in 32.66s =================, , )

**key DB schema**
  - –°—Ö–µ–º–∞ –Ω–µ –º–µ–Ω—è–ª–∞—Å—å.

**changes in tech stack**
  - –ù–µ—Ç.

**All files**
- **–°–æ–∑–¥–∞–Ω—ã:**
  - : , , , , , , , , , , .
  - , .
  - : , , , .
  - .
- **–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–µ–Ω—ã:**
  - **–í—Å–µ —Ñ–∞–π–ª—ã –≤ **: –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤.
  - ****: –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã API, –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤ –∏ middleware.
  - : –î–µ–∫–æ—Ä–∞—Ç–æ—Ä  (—Ä–∞–Ω–µ–µ ) –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–±—Ä–∏–∫–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤.
  - : –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∏–ª—è –≤ –∫–ª–∞—Å—Å.

**Areas that need refactoring**:
- ****: –ì–ª–∞–≤–Ω—ã–π –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–∞–Ω–¥–∏–¥–∞—Ç –Ω–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–Ω–µ—Å—Ç–∏ –∏–∑ –Ω–µ–≥–æ ~113 –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.
- ****: –§–∞–π–ª —Å —Ç–µ—Å—Ç–∞–º–∏ —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–∫–æ–≤ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ—Ä–≤–∏—Å–æ–≤.

**Critical Info for New Agent**
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Ññ1**: –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é , –ø–µ—Ä–µ–Ω–µ—Å—è –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ –≤  –∏–ª–∏ . –≠—Ç–æ –∑–∞–≤–µ—Ä—à–∏—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥.
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Ññ2**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å 5 –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É—Å–ø–µ—Ö–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞. –ù–∞—á–Ω–∏—Ç–µ —Å 3 —Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å–ª–æ–º–∞–ª–∏—Å—å –∏–∑-–∑–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –º–æ–∫–æ–≤, —Ç–∞–∫ –∫–∞–∫ –∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—â–µ.
- –ù–µ –Ω–∞—á–∏–Ω–∞–π—Ç–µ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤.
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—à–ª–∞ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤ –º–∞—Å—à—Ç–∞–±–Ω–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞. –ë—É–¥—å—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã –∫ –∏–º–ø–æ—Ä—Ç–∞–º –∏ –≤—ã–∑–æ–≤–∞–º —Ñ—É–Ω–∫—Ü–∏–π, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –º–æ–≥–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –≤–æ –≤—Å–µ–º –ø—Ä–æ–µ–∫—Ç–µ.

**documents created in this job**
  - /app/backend/docs/REFACTORING_SUMMARY.md
  - /app/backend/docs/INTEGRATION_PROGRESS.md (–æ–±–Ω–æ–≤–ª—è–ª—Å—è)

**Last 5 User Messages and any pending user messages**
 - **User:** –¥–µ–ª–∞–π –≤—Å–µ (Do everything - confirmed radical refactoring) - **Status:** IN PROGRESS
 - **User:** —Å (C - selected an option from the plan) - **Status:** COMPLETED
 - **User:** –ø—Ä–æ–¥–æ–ª–∂–∏ (Continue) - **Status:** COMPLETED
 - **User:** –¥–ª—è –∫–∞–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –µ—â–µ —Ç—ã –±—ã —Å–¥–µ–ª–∞–ª —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥? (What other functions would you refactor?) - **Status:** COMPLETED
 - **User:** –ü—Ä–æ–¥–æ–ª–∂–∏ (Continue) - **Status:** IN PROGRESS

**Project Health Check:**
- **Broken:** 5 —Ç–µ—Å—Ç–æ–≤ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç (2 flaky, 3 –∏–∑-–∑–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –º–æ–∫–æ–≤).
- **Mocked:** –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–∫–∏ —É—Å—Ç–∞—Ä–µ–ª–∏.

**Testing status**
  - Testing agent used after significant changes: NO
  - Troubleshoot agent used after agent stuck in loop: NO
  - Test files created: []
  - Known regressions: 3 —Ç–µ—Å—Ç–∞ –≤  –∏  —Å–ª–æ–º–∞–ª–∏—Å—å –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.

**Credentials to test flow:**
–ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è.

**What agent forgot to execute**
–ê–≥–µ–Ω—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞–ª –æ—á–µ–Ω—å –º–µ—Ç–æ–¥–∏—á–Ω–æ –∏ –Ω–µ —É–ø—É—Å—Ç–∏–ª –Ω–∏—á–µ–≥–æ –∏–∑ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ. –û–Ω –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è–ª —Ñ–∞–∑—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞, —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞—è –∫–∞–∂–¥—ã–π –∫—Ä—É–ø–Ω—ã–π —à–∞–≥ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º. –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –±—ã–ª–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Ç–µ–º–ø–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–¥–∞—á–∏.</analysis>
