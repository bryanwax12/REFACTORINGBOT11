<analysis>**original_problem_statement:**
Ð˜Ð·Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾ Ð·Ð°Ð´Ð°Ñ‡Ð° ÑÐ¾ÑÑ‚Ð¾ÑÐ»Ð° Ð² Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ðµ Ð¸ Ð°ÑƒÐ´Ð¸Ñ‚Ðµ Telegram-Ð±Ð¾Ñ‚Ð°. ÐŸÐ¾ÑÐ»Ðµ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð½Ð¾Ð³Ð¾ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ð²Ð¾Ð·Ð½Ð¸ÐºÐ»Ð¸ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð² Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¼ Ñ„Ð»Ð¾Ñƒ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð°Ð³ÐµÐ½Ñ‚ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐ». Ð¢ÐµÐºÑƒÑ‰Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ â€” Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»Ð½ÑƒÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ñ„Ð»Ð¾Ñƒ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð·Ð°ÐºÐ°Ð·Ð°, Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð², Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ Ð²ÑÐµÑ… ÐºÐ½Ð¾Ð¿Ð¾Ðº Ð¸ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ðµ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸.

PRODUCT REQUIREMENTS:
1.  **Ð¡Ñ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ**: ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ð¼ Ð¸ Ð¾Ñ‚ÐºÐ°Ð·Ð¾ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ñ‹Ð¼.
2.  **Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ**: Ð’ÑÐµ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð¸ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼ ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹.
3.  **ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ ÐºÐ¾Ð´Ð°**: ÐšÐ¾Ð´ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¼Ð¾Ð´ÑƒÐ»ÑŒÐ½Ñ‹Ð¼, ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼, Ñ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ð´ÑƒÐ±Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼.
4.  **ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð¸Ñ€ÑƒÐµÐ¼Ð¾ÑÑ‚ÑŒ**: Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð´Ð¾Ð»Ð¶Ð½Ð° Ð»ÐµÐ³ÐºÐ¾ Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°Ñ‚ÑŒÑÑ Ñ‡ÐµÑ€ÐµÐ·  Ñ„Ð°Ð¹Ð».
5.  **Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ**: ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ„Ð»Ð¾Ñƒ Telegram-Ð±Ð¾Ñ‚Ð° Ð¿Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸ÑŽ Ð·Ð°ÐºÐ°Ð·Ð° Ð´Ð¾Ð»Ð¶ÐµÐ½ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±Ð¾Ðº, Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð²ÑÐµ ÐºÐ½Ð¾Ð¿ÐºÐ¸ (Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ðµ Ñ€Ð°Ð·Ð¼ÐµÑ€Ñ‹, ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·, Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ðº Ð·Ð°ÐºÐ°Ð·Ñƒ, ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹). Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ, ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ Ð¸ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°Ñ‚ÑŒÑÑ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾. Ð”Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° ÑÐºÑ€Ñ‹Ñ‚Ð°Ñ Ð½Ð°Ñ†ÐµÐ½ÐºÐ° Ð² 0.

**User's preferred language**: Ð ÑƒÑÑÐºÐ¸Ð¹

**what currently exists?**
Ð‘Ð¾Ñ‚ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´Ð¸Ñ‚ Ñ„Ð»Ð¾Ñƒ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð·Ð°ÐºÐ°Ð·Ð° Ð´Ð¾ ÑˆÐ°Ð³Ð° Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð². Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð° Ð»Ð¾Ð³Ð¸ÐºÐ° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð² Ð¸Ð· ShipStation API Ð² Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¼ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ (Sandbox). Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹Ñ… Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð² Ð¾Ñ‚ USPS, FedEx Ð¸ UPS, Ð° Ñ‚Ð°ÐºÐ¶Ðµ Ð¸Ñ… ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° (ÑÐ½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð¾ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð·Ñ‡Ð¸ÐºÑƒ, Ð·Ð°Ñ‚ÐµÐ¼ Ð¿Ð¾ Ñ†ÐµÐ½Ðµ). Ð’Ð½ÐµÐ´Ñ€ÐµÐ½Ð° ÑÐºÑ€Ñ‹Ñ‚Ð°Ñ Ð½Ð°Ñ†ÐµÐ½ÐºÐ° Ð² 0 Ð½Ð° ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð»ÐµÐ¹Ð±Ð». ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ñ‚Ð°Ñ€Ð¸Ñ„Ð°, Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹ Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð±Ñ‹Ð»Ð¸ Ñ‡Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ñ‹, Ð½Ð¾ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸. Ð‘Ñ‹Ð»Ð¸ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð¼Ð½Ð¾Ð³Ð¾Ñ‡Ð¸ÑÐ»ÐµÐ½Ð½Ñ‹Ðµ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹, ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ñ ÐºÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹ Python, ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ð°Ð¼Ð¸ polling-ÑÐµÑÑÐ¸Ð¹ Telegram, Ð¿Ð¾Ñ€ÑÐ´ÐºÐ¾Ð¼ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð¸ Ð½ÐµÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸ÐµÐ¼ ÐºÐ»ÑŽÑ‡ÐµÐ¹ Ð´Ð°Ð½Ð½Ñ‹Ñ….

**Last working item**:
    - Last item agent was working: ÐÐ³ÐµÐ½Ñ‚ Ð¿Ñ‹Ñ‚Ð°Ð»ÑÑ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ñ€Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹, Ð¾ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ð» Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ: 1) ÐšÐ½Ð¾Ð¿ÐºÐ° ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹ Ð½Ðµ Ð´ÐµÐ»Ð°ÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ðº API, Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ ÐºÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ. 2) ÐŸÑ€Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¸ Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð² Ð½Ðµ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð¿Ð¾Ð¸ÑÐºÐµ, ÐºÐ°Ðº Ð¿Ñ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ. 3) Ð’ ÑÐ¿Ð¸ÑÐºÐµ Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð² Ð½Ðµ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÑŽÑ‚ÑÑ ÑÐµÑ€Ð²Ð¸ÑÑ‹ USPS.
    - Status: IN PROGRESS
    - Agent Testing Done: N
    - Which testing method agent to use? backend testing agent (manual bot testing).
    - User Testing Done: N

**All Pending/In progress Issue list**:
  - Issue 1: (P0) ÐšÐ½Ð¾Ð¿ÐºÐ° ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾.
  - Issue 2: (P1) Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹ USPS Ð½Ðµ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÑŽÑ‚ÑÑ Ð² ÑÐ¿Ð¸ÑÐºÐµ.
  - Issue 3: (P2) ÐšÐ½Ð¾Ð¿ÐºÐ¸ â†©ï¸ Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ðº Ð·Ð°ÐºÐ°Ð·Ñƒ Ð¸ âœ… Ð”Ð°, Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð½Ðµ Ð±Ñ‹Ð»Ð¸ Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð¿Ð¾ÑÐ»Ðµ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°.
  
  Issues Detail:
  - Issue 1: 
     - Attempted fixes: ÐÐ³ÐµÐ½Ñ‚ Ð´Ð¾Ð±Ð°Ð²Ð¸Ð» Ð¾Ñ‡Ð¸ÑÑ‚ÐºÑƒ  Ð¸  Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ñ€Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ñ ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼Ð¸. ÐžÐ´Ð½Ð°ÐºÐ¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ð», Ñ‡Ñ‚Ð¾ ÑÑ‚Ð¾ Ð½Ðµ Ñ€ÐµÑˆÐ¸Ð»Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ, Ð¸ Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ð», Ñ‡Ñ‚Ð¾ Ð´ÐµÐ»Ð¾ Ð² .
     - Next debug checklist: 
        1. ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ñ„Ð°Ð¹Ð» .
        2. Ð’ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐµ , Ð² Ð±Ð»Ð¾ÐºÐµ , Ð½Ð°Ð¹Ñ‚Ð¸ Ð¸ Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ ÐºÐµÑˆ Ð¸Ð· , Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ ÐºÐ»ÑŽÑ‡, ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð½Ñ‹Ð¹ Ð² .
        3. ÐŸÐ¾ÑÐ»Ðµ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸ ÐºÐµÑˆÐ° Ð²Ñ‹Ð·Ð²Ð°Ñ‚ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ . Ð­Ñ‚Ð¾ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ñ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ API-Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð¿Ð¾Ð¸ÑÐºÐµ.
        4. Ð£Ð±ÐµÐ´Ð¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ð¾ ÑÑ‚Ð°Ñ€Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼Ð¸ ÑƒÐ´Ð°Ð»ÑÐµÑ‚ÑÑ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ .
     - Why fix this issue and what will be achieved with the fix? ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹, Ñ‡Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð±ÐµÑÐ¿Ð¾Ð»ÐµÐ·Ð½Ð¾Ð¹.
     - Status:  IN PROGRESS
     - Is recurring issue? Y
     - Should Test frontend/backend/both after fix? backend
     - Blocked on other issue: ÐÐµÑ‚
  - Issue 2: 
     - Attempted fixes: ÐÐ³ÐµÐ½Ñ‚ Ð´Ð¾Ð±Ð°Ð²Ð¸Ð» Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð² Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ  Ð² Ñ„Ð°Ð¹Ð»Ðµ  Ð´Ð»Ñ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ, ÐºÐ°ÐºÐ¸Ðµ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´ÑÑ‚ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ.
     - Next debug checklist: 
        1. ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ„Ð»Ð¾Ñƒ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð².
        2. Ð¡Ñ€Ð°Ð·Ñƒ Ð¿Ð¾ÑÐ»Ðµ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð»Ð¾Ð³ Ð±ÑÐºÐµÐ½Ð´Ð° (ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=43)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=43)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=43)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=43)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot
ðŸ”‘ ShipStation API Key loading: PROD=SET, TEST=SET, DEFAULT=SET, FINAL=SET (len=48)
ðŸ”µ PREVIEW DATABASE: telegram_shipping_bot
ðŸ“¦ Repository Manager initialized successfully
ðŸ”µ BOT CONFIGURATION:
   Environment: TEST
   Mode: ðŸ”„ POLLING
   Active Bot: @whitelabel_shipping_bot_test_bot
âœ… Bot instance created: @whitelabel_shipping_bot_test_bot).
        3. ÐÐ°Ð¹Ñ‚Ð¸ Ð² Ð»Ð¾Ð³Ð°Ñ… ÑÑ‚Ñ€Ð¾ÐºÐ¸  Ð¸ .
        4. ÐŸÑ€Ð¾Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ, Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹ USPS (ÐµÑÐ»Ð¸ Ð¾Ð½Ð¸ Ð¿Ñ€Ð¸Ñ…Ð¾Ð´ÑÑ‚ Ð¾Ñ‚ API) Ð½Ðµ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´ÑÑ‚ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ. Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾, Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð² Ð½ÐµÑ‚Ð¾Ñ‡Ð½Ð¾Ð¼ ÑÐ¾Ð²Ð¿Ð°Ð´ÐµÐ½Ð¸Ð¸ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ð¹ Ð²  Ð¸Ð»Ð¸ Ð² Ð»Ð¾Ð³Ð¸ÐºÐµ .
     - Why fix this issue and what will be achieved with the fix? ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð²Ð¸Ð´Ð¸Ñ‚ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð¸Ð· ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ñ… Ð¿ÐµÑ€ÐµÐ²Ð¾Ð·Ñ‡Ð¸ÐºÐ¾Ð².
     - Status:  IN PROGRESS
     - Is recurring issue? Y
     - Should Test frontend/backend/both after fix? backend
     - Blocked on other issue: ÐÐµÑ‚
  - Issue 3: 
     - Attempted fixes: ÐÐ³ÐµÐ½Ñ‚ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð» Ð»Ð¾Ð³Ð¸ÐºÑƒ ÐºÐ½Ð¾Ð¿Ð¾Ðº Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹ Ð² Ñ„Ð°Ð¹Ð»Ðµ , Ð½Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ð» Ð¸Ñ… Ñ€Ð°Ð±Ð¾Ñ‚Ð¾ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð¾ÑÑ‚ÑŒ.
     - Next debug checklist: 
        1. ÐŸÐ¾ÑÐ»Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ P0 Ð¸ P1, Ð¿Ð¾Ð¿Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹ Ð½Ð° Ñ€Ð°Ð·Ð½Ñ‹Ñ… ÑÑ‚Ð°Ð¿Ð°Ñ….
        2. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾  ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐ°ÐµÑ‚ÑÑ Ð¸Ð»Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ Ð½Ð° Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¹ ÑˆÐ°Ð³.
     - Why fix this issue and what will be achieved with the fix? Ð£Ð»ÑƒÑ‡ÑˆÐ°ÐµÑ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ð¹ Ð¾Ð¿Ñ‹Ñ‚, Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÑ Ð¾Ñ‚Ð¼ÐµÐ½ÑÑ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ.
     - Status:  NOT STARTED
     - Is recurring issue? N
     - Should Test frontend/backend/both after fix? backend
     - Blocked on other issue: ÐÐµÑ‚

**In progress Task List**:
ÐÐµÑ‚.

**Upcoming and Future Tasks**
 Upcoming Tasks:
    - (P1) **Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð»Ð¸Ð½Ñ‚Ð¸Ð½Ð³Ð°**: Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ E402 Module level import not at top of file
   --> backend/handlers/common_handlers.py:134:1
    |
132 | # ==================== COMMAND HANDLERS ====================
133 |
134 | from utils.handler_decorators import with_user_session, safe_handler, with_typing_action
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
135 |
136 | @safe_handler(fallback_state=ConversationHandler.END)
    |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/cancellation.py:12:1
   |
10 | logger = logging.getLogger(__name__)
11 |
12 | from utils.handler_decorators import with_user_session, safe_handler, with_services
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/confirmation.py:12:1
   |
10 | logger = logging.getLogger(__name__)
11 |
12 | from utils.handler_decorators import with_user_session, safe_handler
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
13 | from handlers.common_handlers import safe_telegram_call, mark_message_as_selected, check_stale_interaction
14 | from handlers.order_flow.cancellation import cancel_order
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/confirmation.py:13:1
   |
12 | from utils.handler_decorators import with_user_session, safe_handler
13 | from handlers.common_handlers import safe_telegram_call, mark_message_as_selected, check_stale_interaction
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 | from handlers.order_flow.cancellation import cancel_order
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/confirmation.py:14:1
   |
12 | from utils.handler_decorators import with_user_session, safe_handler
13 | from handlers.common_handlers import safe_telegram_call, mark_message_as_selected, check_stale_interaction
14 | from handlers.order_flow.cancellation import cancel_order
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

F821 Undefined name `confirm_cancel_order`
   --> backend/handlers/order_flow/confirmation.py:157:22
    |
156 |     if query.data == 'confirm_cancel':
157 |         return await confirm_cancel_order(update, context)
    |                      ^^^^^^^^^^^^^^^^^^^^
158 |     
159 |     if query.data == 'return_to_order':
    |

F821 Undefined name `return_to_order`
   --> backend/handlers/order_flow/confirmation.py:160:22
    |
159 |     if query.data == 'return_to_order':
160 |         return await return_to_order(update, context)
    |                      ^^^^^^^^^^^^^^^
161 |     
162 |     if query.data == 'confirm_data':
    |

F821 Undefined name `fetch_shipping_rates`
   --> backend/handlers/order_flow/confirmation.py:165:22
    |
163 |         # User confirmed data, proceed to fetch rates
164 |         logger.info("âœ… User confirmed data, calling fetch_shipping_rates...")
165 |         return await fetch_shipping_rates(update, context)
    |                      ^^^^^^^^^^^^^^^^^^^^
166 |     
167 |     if query.data == 'save_template':
    |

F821 Undefined name `TEMPLATE_NAME`
   --> backend/handlers/order_flow/confirmation.py:176:16
    |
174 |             parse_mode='Markdown',
175 |         ))
176 |         return TEMPLATE_NAME
    |                ^^^^^^^^^^^^^
177 |     
178 |     if query.data == 'edit_data':
    |

F821 Undefined name `STATE_NAMES`
   --> backend/handlers/order_flow/confirmation.py:200:43
    |
198 |         if bot_msg:
199 |             context.user_data['last_bot_message_id'] = bot_msg.message_id
200 |         context.user_data['last_state'] = STATE_NAMES[FROM_NAME]
    |                                           ^^^^^^^^^^^
201 |         return FROM_NAME
    |

F821 Undefined name `FROM_NAME`
   --> backend/handlers/order_flow/confirmation.py:200:55
    |
198 |         if bot_msg:
199 |             context.user_data['last_bot_message_id'] = bot_msg.message_id
200 |         context.user_data['last_state'] = STATE_NAMES[FROM_NAME]
    |                                                       ^^^^^^^^^
201 |         return FROM_NAME
    |

F821 Undefined name `FROM_NAME`
   --> backend/handlers/order_flow/confirmation.py:201:16
    |
199 |             context.user_data['last_bot_message_id'] = bot_msg.message_id
200 |         context.user_data['last_state'] = STATE_NAMES[FROM_NAME]
201 |         return FROM_NAME
    |                ^^^^^^^^^
202 |     
203 |     if query.data == 'edit_to_address':
    |

F821 Undefined name `STATE_NAMES`
   --> backend/handlers/order_flow/confirmation.py:217:43
    |
215 |         if bot_msg:
216 |             context.user_data['last_bot_message_id'] = bot_msg.message_id
217 |         context.user_data['last_state'] = STATE_NAMES[TO_NAME]
    |                                           ^^^^^^^^^^^
218 |         return TO_NAME
    |

F821 Undefined name `TO_NAME`
   --> backend/handlers/order_flow/confirmation.py:217:55
    |
215 |         if bot_msg:
216 |             context.user_data['last_bot_message_id'] = bot_msg.message_id
217 |         context.user_data['last_state'] = STATE_NAMES[TO_NAME]
    |                                                       ^^^^^^^
218 |         return TO_NAME
    |

F821 Undefined name `TO_NAME`
   --> backend/handlers/order_flow/confirmation.py:218:16
    |
216 |             context.user_data['last_bot_message_id'] = bot_msg.message_id
217 |         context.user_data['last_state'] = STATE_NAMES[TO_NAME]
218 |         return TO_NAME
    |                ^^^^^^^
219 |     
220 |     if query.data == 'edit_parcel':
    |

F821 Undefined name `STATE_NAMES`
   --> backend/handlers/order_flow/confirmation.py:234:43
    |
232 |         if bot_msg:
233 |             context.user_data['last_bot_message_id'] = bot_msg.message_id
234 |         context.user_data['last_state'] = STATE_NAMES[PARCEL_WEIGHT]
    |                                           ^^^^^^^^^^^
235 |         return PARCEL_WEIGHT
    |

F821 Undefined name `PARCEL_WEIGHT`
   --> backend/handlers/order_flow/confirmation.py:234:55
    |
232 |         if bot_msg:
233 |             context.user_data['last_bot_message_id'] = bot_msg.message_id
234 |         context.user_data['last_state'] = STATE_NAMES[PARCEL_WEIGHT]
    |                                                       ^^^^^^^^^^^^^
235 |         return PARCEL_WEIGHT
    |

F821 Undefined name `PARCEL_WEIGHT`
   --> backend/handlers/order_flow/confirmation.py:235:16
    |
233 |             context.user_data['last_bot_message_id'] = bot_msg.message_id
234 |         context.user_data['last_state'] = STATE_NAMES[PARCEL_WEIGHT]
235 |         return PARCEL_WEIGHT
    |                ^^^^^^^^^^^^^
236 |     
237 |     if query.data == 'back_to_confirmation':
    |

F811 Redefinition of unused `select_carrier` from line 33
  --> backend/handlers/order_flow/conversation_setup.py:83:46
   |
81 |     )
82 |     from handlers.order_flow.rates import fetch_shipping_rates
83 |     from handlers.order_flow.carriers import select_carrier
   |                                              ^^^^^^^^^^^^^^ `select_carrier` redefined here
84 |     from handlers.order_flow.cancellation import (
85 |         cancel_order,
   |
  ::: backend/handlers/order_flow/conversation_setup.py:33:9
   |
31 |         TEMPLATE_NAME, TEMPLATE_LIST, TEMPLATE_VIEW, TEMPLATE_LOADED,
32 |         # Handler functions from server.py (large functions)
33 |         select_carrier,
   |         -------------- previous definition of `select_carrier` here
34 |         order_from_template_list, use_template, view_template,
35 |         delete_template, confirm_delete_template, my_templates_menu,
   |
help: Remove definition: `select_carrier`

E402 Module level import not at top of file
  --> backend/handlers/order_flow/entry_points.py:13:1
   |
13 | from utils.handler_decorators import with_user_session, safe_handler
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 |
15 | @safe_handler(fallback_state=ConversationHandler.END)
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/from_address.py:13:1
   |
12 | # Import shared utilities
13 | from handlers.common_handlers import safe_telegram_call, mark_message_as_selected
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 | from utils.validators import (
15 |     validate_name, validate_address, validate_city,
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/from_address.py:14:1
   |
12 |   # Import shared utilities
13 |   from handlers.common_handlers import safe_telegram_call, mark_message_as_selected
14 | / from utils.validators import (
15 | |     validate_name, validate_address, validate_city,
16 | |     validate_state, validate_zip, validate_phone
17 | | )
   | |_^
18 |   from utils.handler_decorators import with_user_session, safe_handler, with_typing_action, with_services
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/from_address.py:18:1
   |
16 |     validate_state, validate_zip, validate_phone
17 | )
18 | from utils.handler_decorators import with_user_session, safe_handler, with_typing_action, with_services
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
19 |
20 | # These will be imported from server when handlers are called
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/parcel.py:13:1
   |
12 | # Import shared utilities
13 | from handlers.common_handlers import safe_telegram_call, mark_message_as_selected
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 | from utils.validators import validate_weight, validate_dimension
15 | from utils.handler_decorators import with_user_session, safe_handler, with_typing_action, with_services
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/parcel.py:14:1
   |
12 | # Import shared utilities
13 | from handlers.common_handlers import safe_telegram_call, mark_message_as_selected
14 | from utils.validators import validate_weight, validate_dimension
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
15 | from utils.handler_decorators import with_user_session, safe_handler, with_typing_action, with_services
16 | from telegram.ext import ConversationHandler
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/parcel.py:15:1
   |
13 | from handlers.common_handlers import safe_telegram_call, mark_message_as_selected
14 | from utils.validators import validate_weight, validate_dimension
15 | from utils.handler_decorators import with_user_session, safe_handler, with_typing_action, with_services
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 | from telegram.ext import ConversationHandler
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/parcel.py:16:1
   |
14 | from utils.validators import validate_weight, validate_dimension
15 | from utils.handler_decorators import with_user_session, safe_handler, with_typing_action, with_services
16 | from telegram.ext import ConversationHandler
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/payment.py:11:1
   |
 9 | logger = logging.getLogger(__name__)
10 |
11 | from utils.handler_decorators import with_user_session, safe_handler
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

F821 Undefined name `check_stale_interaction`
   --> backend/handlers/order_flow/payment.py:172:14
    |
171 |     # Check for stale interaction
172 |     if await check_stale_interaction(query, context):
    |              ^^^^^^^^^^^^^^^^^^^^^^^
173 |         return ConversationHandler.END
    |

F821 Undefined name `safe_telegram_call`
   --> backend/handlers/order_flow/payment.py:175:11
    |
173 |         return ConversationHandler.END
174 |     
175 |     await safe_telegram_call(query.answer())
    |           ^^^^^^^^^^^^^^^^^^
176 |     
177 |     if query.data == 'cancel_order':
    |

F821 Undefined name `cancel_order`
   --> backend/handlers/order_flow/payment.py:178:22
    |
177 |     if query.data == 'cancel_order':
178 |         return await cancel_order(update, context)
    |                      ^^^^^^^^^^^^
179 |     
180 |     if query.data == 'confirm_cancel':
    |

F821 Undefined name `confirm_cancel_order`
   --> backend/handlers/order_flow/payment.py:181:22
    |
180 |     if query.data == 'confirm_cancel':
181 |         return await confirm_cancel_order(update, context)
    |                      ^^^^^^^^^^^^^^^^^^^^
182 |     
183 |     if query.data == 'return_to_order':
    |

F821 Undefined name `return_to_order`
   --> backend/handlers/order_flow/payment.py:184:22
    |
183 |     if query.data == 'return_to_order':
184 |         return await return_to_order(update, context)
    |                      ^^^^^^^^^^^^^^^
185 |     
186 |     # Handle back to rates
    |

F821 Undefined name `asyncio`
   --> backend/handlers/order_flow/payment.py:189:9
    |
187 |     if query.data == 'back_to_rates':
188 |         # Mark previous message as selected (remove buttons and add "âœ… Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð¾")
189 |         asyncio.create_task(mark_message_as_selected(update, context))
    |         ^^^^^^^
190 |         # Return to rate selection - call fetch_shipping_rates again
191 |         return await fetch_shipping_rates(update, context)
    |

F821 Undefined name `mark_message_as_selected`
   --> backend/handlers/order_flow/payment.py:189:29
    |
187 |     if query.data == 'back_to_rates':
188 |         # Mark previous message as selected (remove buttons and add "âœ… Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð¾")
189 |         asyncio.create_task(mark_message_as_selected(update, context))
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^
190 |         # Return to rate selection - call fetch_shipping_rates again
191 |         return await fetch_shipping_rates(update, context)
    |

F821 Undefined name `fetch_shipping_rates`
   --> backend/handlers/order_flow/payment.py:191:22
    |
189 |         asyncio.create_task(mark_message_as_selected(update, context))
190 |         # Return to rate selection - call fetch_shipping_rates again
191 |         return await fetch_shipping_rates(update, context)
    |                      ^^^^^^^^^^^^^^^^^^^^
192 |     
193 |     # Mark previous message as selected (remove buttons)
    |

F821 Undefined name `asyncio`
   --> backend/handlers/order_flow/payment.py:194:5
    |
193 |     # Mark previous message as selected (remove buttons)
194 |     asyncio.create_task(mark_message_as_selected(update, context))
    |     ^^^^^^^
195 |     
196 |     telegram_id = query.from_user.id
    |

F821 Undefined name `mark_message_as_selected`
   --> backend/handlers/order_flow/payment.py:194:25
    |
193 |     # Mark previous message as selected (remove buttons)
194 |     asyncio.create_task(mark_message_as_selected(update, context))
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^
195 |     
196 |     telegram_id = query.from_user.id
    |

F821 Undefined name `safe_telegram_call`
   --> backend/handlers/order_flow/payment.py:213:23
    |
211 |             from utils.ui_utils import PaymentFlowUI
212 |             if user.get('balance', 0) < amount:
213 |                 await safe_telegram_call(query.message.reply_text(PaymentFlowUI.insufficient_balance_error()))
    |                       ^^^^^^^^^^^^^^^^^^
214 |                 return ConversationHandler.END
    |

F821 Undefined name `create_order_in_db`
   --> backend/handlers/order_flow/payment.py:217:27
    |
216 |             # Create order
217 |             order = await create_order_in_db(user, data, selected_rate, amount, user_discount, discount_amount)
    |                           ^^^^^^^^^^^^^^^^^^
218 |             
219 |             # Try to create shipping label first
    |

F821 Undefined name `create_and_send_label`
   --> backend/handlers/order_flow/payment.py:220:35
    |
219 |             # Try to create shipping label first
220 |             label_created = await create_and_send_label(order['id'], telegram_id, query.message)
    |                                   ^^^^^^^^^^^^^^^^^^^^^
221 |             
222 |             if label_created:
    |

F821 Undefined name `payment_service`
   --> backend/handlers/order_flow/payment.py:224:53
    |
222 |             if label_created:
223 |                 # Only deduct balance if label was created successfully using payment service
224 |                 success, new_balance, error = await payment_service.process_balance_payment(
    |                                                     ^^^^^^^^^^^^^^^
225 |                     telegram_id=telegram_id,
226 |                     amount=amount,
    |

F821 Undefined name `db`
   --> backend/handlers/order_flow/payment.py:228:24
    |
226 |                     amount=amount,
227 |                     order_id=order['id'],
228 |                     db=db,
    |                        ^^
229 |                     find_user_func=find_user_by_telegram_id,
230 |                     update_order_func=update_order
    |

F821 Undefined name `find_user_by_telegram_id`
   --> backend/handlers/order_flow/payment.py:229:36
    |
227 |                     order_id=order['id'],
228 |                     db=db,
229 |                     find_user_func=find_user_by_telegram_id,
    |                                    ^^^^^^^^^^^^^^^^^^^^^^^^
230 |                     update_order_func=update_order
231 |                 )
    |

F821 Undefined name `update_order`
   --> backend/handlers/order_flow/payment.py:230:39
    |
228 |                     db=db,
229 |                     find_user_func=find_user_by_telegram_id,
230 |                     update_order_func=update_order
    |                                       ^^^^^^^^^^^^
231 |                 )
    |

F821 Undefined name `safe_telegram_call`
   --> backend/handlers/order_flow/payment.py:236:27
    |
234 |                     logger.error(f"Failed to process payment: {error}")
235 |                     # This shouldn't happen as we checked balance earlier
236 |                     await safe_telegram_call(query.message.reply_text(f"âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°: {error}"))
    |                           ^^^^^^^^^^^^^^^^^^
237 |                     return ConversationHandler.END
    |

F821 Undefined name `safe_telegram_call`
   --> backend/handlers/order_flow/payment.py:243:23
    |
241 |                 reply_markup = InlineKeyboardMarkup(keyboard)
242 |                 
243 |                 await safe_telegram_call(query.message.reply_text(
    |                       ^^^^^^^^^^^^^^^^^^
244 |                     PaymentFlowUI.payment_success_balance(amount, new_balance, order.get('order_id')),
245 |                     reply_markup=reply_markup
    |

F821 Undefined name `safe_telegram_call`
   --> backend/handlers/order_flow/payment.py:263:23
    |
261 |                 reply_markup = InlineKeyboardMarkup(keyboard)
262 |                 
263 |                 await safe_telegram_call(query.message.reply_text(
    |                       ^^^^^^^^^^^^^^^^^^
264 |             """âŒ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ shipping label.
265 |             ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð½Ðµ ÑÐ¿Ð¸ÑÐ°Ð½Ð°. Ð’Ð°Ñˆ Ð±Ð°Ð»Ð°Ð½Ñ Ð½Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»ÑÑ.
    |

F821 Undefined name `create_order_in_db`
   --> backend/handlers/order_flow/payment.py:276:27
    |
274 |         elif query.data == 'pay_with_crypto':
275 |             # Create order
276 |             order = await create_order_in_db(user, data, selected_rate, amount, user_discount, discount_amount)
    |                           ^^^^^^^^^^^^^^^^^^
277 |             
278 |             # Create Oxapay invoice
    |

F821 Undefined name `create_oxapay_invoice`
   --> backend/handlers/order_flow/payment.py:279:36
    |
278 |             # Create Oxapay invoice
279 |             invoice_result = await create_oxapay_invoice(
    |                                    ^^^^^^^^^^^^^^^^^^^^^
280 |                 amount=amount,
281 |                 order_id=order['id'],
    |

F821 Undefined name `Payment`
   --> backend/handlers/order_flow/payment.py:289:27
    |
287 |                 pay_link = invoice_result['payLink']
288 |                 
289 |                 payment = Payment(
    |                           ^^^^^^^
290 |                     order_id=order['id'],
291 |                     amount=amount,
    |

F821 Undefined name `insert_payment`
   --> backend/handlers/order_flow/payment.py:297:23
    |
295 |                 payment_dict = payment.model_dump()
296 |                 payment_dict['created_at'] = payment_dict['created_at'].isoformat()
297 |                 await insert_payment(payment_dict)
    |                       ^^^^^^^^^^^^^^
298 |                 
299 |                 keyboard = [[InlineKeyboardButton("ðŸ’³ ÐžÐ¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ", url=pay_link)],
    |

F821 Undefined name `session_manager`
   --> backend/handlers/order_flow/payment.py:305:33
    |
303 |                 # Get order_id from session for display
304 |                 from utils.order_utils import format_order_id_for_display
305 |                 session = await session_manager.get_session(telegram_id)
    |                                 ^^^^^^^^^^^^^^^
306 |                 order_id_display = ""
307 |                 if session and session.get('order_id'):
    |

F821 Undefined name `safe_telegram_call`
   --> backend/handlers/order_flow/payment.py:311:23
    |
309 |                     order_id_display = f"\nðŸ“¦ ÐÐ¾Ð¼ÐµÑ€ Ð·Ð°ÐºÐ°Ð·Ð°: #{display_id}\n"
310 |                 
311 |                 await safe_telegram_call(query.message.reply_text(
    |                       ^^^^^^^^^^^^^^^^^^
312 |                     f"""âœ… Ð—Ð°ÐºÐ°Ð· ÑÐ¾Ð·Ð´Ð°Ð½!{order_id_display}
    |

F821 Undefined name `safe_telegram_call`
   --> backend/handlers/order_flow/payment.py:324:23
    |
322 |             else:
323 |                 error_msg = invoice_result.get('error', 'Unknown error')
324 |                 await safe_telegram_call(query.message.reply_text(f"âŒ ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¸Ð½Ð²Ð¾Ð¹ÑÐ°: {error_msg}"))
    |                       ^^^^^^^^^^^^^^^^^^
325 |         elif query.data == 'top_up_balance':
326 |             # Save order data to database before top-up so user can return to payment after
    |

F821 Undefined name `datetime`
   --> backend/handlers/order_flow/payment.py:351:31
    |
349 |                 'parcel_width': data.get('parcel_width'),
350 |                 'parcel_height': data.get('parcel_height'),
351 |                 'created_at': datetime.now(timezone.utc).isoformat()
    |                               ^^^^^^^^
352 |             }
    |

F821 Undefined name `timezone`
   --> backend/handlers/order_flow/payment.py:351:44
    |
349 |                 'parcel_width': data.get('parcel_width'),
350 |                 'parcel_height': data.get('parcel_height'),
351 |                 'created_at': datetime.now(timezone.utc).isoformat()
    |                                            ^^^^^^^^
352 |             }
    |

F821 Undefined name `db`
   --> backend/handlers/order_flow/payment.py:355:19
    |
354 |             # Delete any existing pending order for this user
355 |             await db.pending_orders.delete_many({"telegram_id": telegram_id})
    |                   ^^
356 |             # Save new pending order
357 |             await insert_pending_order(pending_order)
    |

F821 Undefined name `insert_pending_order`
   --> backend/handlers/order_flow/payment.py:357:19
    |
355 |             await db.pending_orders.delete_many({"telegram_id": telegram_id})
356 |             # Save new pending order
357 |             await insert_pending_order(pending_order)
    |                   ^^^^^^^^^^^^^^^^^^^^
358 |             
359 |             context.user_data['last_state'] = STATE_NAMES[TOPUP_AMOUNT]  # Save state for cancel return
    |

F821 Undefined name `STATE_NAMES`
   --> backend/handlers/order_flow/payment.py:359:47
    |
357 |             await insert_pending_order(pending_order)
358 |             
359 |             context.user_data['last_state'] = STATE_NAMES[TOPUP_AMOUNT]  # Save state for cancel return
    |                                               ^^^^^^^^^^^
360 |             
361 |         from utils.ui_utils import get_cancel_keyboard
    |

F821 Undefined name `TOPUP_AMOUNT`
   --> backend/handlers/order_flow/payment.py:359:59
    |
357 |             await insert_pending_order(pending_order)
358 |             
359 |             context.user_data['last_state'] = STATE_NAMES[TOPUP_AMOUNT]  # Save state for cancel return
    |                                                           ^^^^^^^^^^^^
360 |             
361 |         from utils.ui_utils import get_cancel_keyboard
    |

F821 Undefined name `safe_telegram_call`
   --> backend/handlers/order_flow/payment.py:373:25
    |
371 | ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ ÑÑƒÐ¼Ð¼Ð°: $1000"""
372 |         
373 |         bot_msg = await safe_telegram_call(query.message.reply_text(
    |                         ^^^^^^^^^^^^^^^^^^
374 |             message_text,
375 |             reply_markup=reply_markup
    |

F821 Undefined name `TOPUP_AMOUNT`
   --> backend/handlers/order_flow/payment.py:382:16
    |
380 |         context.user_data['last_bot_message_text'] = message_text
381 |         
382 |         return TOPUP_AMOUNT
    |                ^^^^^^^^^^^^
383 |     
384 |     except Exception as e:
    |

F821 Undefined name `safe_telegram_call`
   --> backend/handlers/order_flow/payment.py:386:15
    |
384 |     except Exception as e:
385 |         logger.error(f"Payment error: {e}")
386 |         await safe_telegram_call(query.message.reply_text(f"âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð¿Ð»Ð°Ñ‚Ðµ: {str(e)}"))
    |               ^^^^^^^^^^^^^^^^^^
387 |         return ConversationHandler.END
    |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/rates.py:20:1
   |
19 | # Import state constants
20 | from server import CONFIRM_DATA
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
21 |
22 | # Get ShipStation API key from environment
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/skip_handlers.py:13:1
   |
12 | # Import shared utilities
13 | from handlers.common_handlers import safe_telegram_call, mark_message_as_selected
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 | from utils.ui_utils import get_cancel_keyboard, OrderStepMessages
15 | from utils.handler_decorators import with_user_session, safe_handler
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/skip_handlers.py:14:1
   |
12 | # Import shared utilities
13 | from handlers.common_handlers import safe_telegram_call, mark_message_as_selected
14 | from utils.ui_utils import get_cancel_keyboard, OrderStepMessages
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
15 | from utils.handler_decorators import with_user_session, safe_handler
16 | from telegram.ext import ConversationHandler
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/skip_handlers.py:15:1
   |
13 | from handlers.common_handlers import safe_telegram_call, mark_message_as_selected
14 | from utils.ui_utils import get_cancel_keyboard, OrderStepMessages
15 | from utils.handler_decorators import with_user_session, safe_handler
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 | from telegram.ext import ConversationHandler
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/skip_handlers.py:16:1
   |
14 | from utils.ui_utils import get_cancel_keyboard, OrderStepMessages
15 | from utils.handler_decorators import with_user_session, safe_handler
16 | from telegram.ext import ConversationHandler
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/template_save.py:15:1
   |
13 | logger = logging.getLogger(__name__)
14 |
15 | from utils.handler_decorators import with_user_session, safe_handler
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/to_address.py:13:1
   |
12 | # Import shared utilities
13 | from handlers.common_handlers import safe_telegram_call, mark_message_as_selected
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 | from utils.validators import (
15 |     validate_name, validate_address, validate_city,
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/to_address.py:14:1
   |
12 |   # Import shared utilities
13 |   from handlers.common_handlers import safe_telegram_call, mark_message_as_selected
14 | / from utils.validators import (
15 | |     validate_name, validate_address, validate_city,
16 | |     validate_state, validate_zip, validate_phone
17 | | )
   | |_^
18 |   from utils.handler_decorators import with_user_session, safe_handler, with_typing_action, with_services
19 |   from telegram.ext import ConversationHandler
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/to_address.py:18:1
   |
16 |     validate_state, validate_zip, validate_phone
17 | )
18 | from utils.handler_decorators import with_user_session, safe_handler, with_typing_action, with_services
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
19 | from telegram.ext import ConversationHandler
   |

E402 Module level import not at top of file
  --> backend/handlers/order_flow/to_address.py:19:1
   |
17 | )
18 | from utils.handler_decorators import with_user_session, safe_handler, with_typing_action, with_services
19 | from telegram.ext import ConversationHandler
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

E402 Module level import not at top of file
  --> backend/handlers/order_handlers.py:87:1
   |
85 | """
86 |
87 | import logging
   | ^^^^^^^^^^^^^^
88 | from telegram import Update
89 | from telegram.ext import ContextTypes
   |

E402 Module level import not at top of file
  --> backend/handlers/order_handlers.py:88:1
   |
87 | import logging
88 | from telegram import Update
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^
89 | from telegram.ext import ContextTypes
   |

E402 Module level import not at top of file
  --> backend/handlers/order_handlers.py:89:1
   |
87 | import logging
88 | from telegram import Update
89 | from telegram.ext import ContextTypes
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
90 |
91 | logger = logging.getLogger(__name__)
   |

E402 Module level import not at top of file
  --> backend/handlers/payment_handlers.py:18:1
   |
18 | from utils.handler_decorators import with_user_session, safe_handler, with_services
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
19 |
20 | @safe_handler()
   |

F811 Redefinition of unused `handle_topup_amount_input` from line 84
   --> backend/handlers/payment_handlers.py:266:11
    |
264 | # ==================== TOP-UP HANDLERS ====================
265 |
266 | async def handle_topup_amount_input(update: Update, context: ContextTypes.DEFAULT_TYPE):
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^ `handle_topup_amount_input` redefined here
267 |     """Handle custom topup amount input"""
268 |     from handlers.common_handlers import safe_telegram_call, mark_message_as_selected
    |
   ::: backend/handlers/payment_handlers.py:84:11
    |
 84 | async def handle_topup_amount_input(update: Update, context: ContextTypes.DEFAULT_TYPE, db, create_oxapay_invoice, safe_telegram_call,â€¦
    |           ------------------------- previous definition of `handle_topup_amount_input` here
 85 |     """
 86 |     Handle custom topup amount input from user
    |
help: Remove definition: `handle_topup_amount_input`

F841 Local variable `result` is assigned to but never used
   --> backend/repositories/base_repository.py:172:13
    |
170 |                 document = self._add_timestamps(document, update=False)
171 |             
172 |             result = await self.collection.insert_one(document)
    |             ^^^^^^
173 |             
174 |             logger.info(f"âœ… {self.collection_name}.insert_one: Success")
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> backend/repositories/base_repository.py:203:13
    |
201 |                 ]
202 |             
203 |             result = await self.collection.insert_many(documents)
    |             ^^^^^^
204 |             
205 |             logger.info(f"âœ… {self.collection_name}.insert_many: Inserted {len(documents)} documents")
    |
help: Remove assignment to unused variable `result`

F841 Local variable `summary` is assigned to but never used
  --> backend/routers/bot_config_router.py:53:5
   |
51 |     """
52 |     config = get_bot_config()
53 |     summary = config.get_config_summary()
   |     ^^^^^^^
54 |     
55 |     return {
   |
help: Remove assignment to unused variable `summary`

E722 Do not use bare `except`
   --> backend/routers/legacy_api.py:251:13
    |
249 |                 )
250 |                 users_notified += 1
251 |             except:
    |             ^^^^^^
252 |                 pass
    |

E722 Do not use bare `except`
   --> backend/routers/legacy_api.py:293:13
    |
291 |                 )
292 |                 users_notified += 1
293 |             except:
    |             ^^^^^^
294 |                 pass
    |

E402 Module level import not at top of file
  --> backend/server.py:11:1
   |
 9 | load_dotenv(ROOT_DIR / '.env')
10 |
11 | from bot_protection import BotProtection
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
12 | from telegram_safety import TelegramSafetySystem, TelegramBestPractices
13 | import logging
   |

E402 Module level import not at top of file
  --> backend/server.py:12:1
   |
11 | from bot_protection import BotProtection
12 | from telegram_safety import TelegramSafetySystem, TelegramBestPractices
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
13 | import logging
14 | import httpx
   |

E402 Module level import not at top of file
  --> backend/server.py:13:1
   |
11 | from bot_protection import BotProtection
12 | from telegram_safety import TelegramSafetySystem, TelegramBestPractices
13 | import logging
   | ^^^^^^^^^^^^^^
14 | import httpx
15 | from pydantic import BaseModel, Field, ConfigDict, EmailStr
   |

E402 Module level import not at top of file
  --> backend/server.py:14:1
   |
12 | from telegram_safety import TelegramSafetySystem, TelegramBestPractices
13 | import logging
14 | import httpx
   | ^^^^^^^^^^^^
15 | from pydantic import BaseModel, Field, ConfigDict, EmailStr
16 | from typing import Optional
   |

E402 Module level import not at top of file
  --> backend/server.py:15:1
   |
13 | import logging
14 | import httpx
15 | from pydantic import BaseModel, Field, ConfigDict, EmailStr
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 | from typing import Optional
17 | from datetime import datetime, timezone
   |

E402 Module level import not at top of file
  --> backend/server.py:16:1
   |
14 | import httpx
15 | from pydantic import BaseModel, Field, ConfigDict, EmailStr
16 | from typing import Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^
17 | from datetime import datetime, timezone
18 | import uuid
   |

E402 Module level import not at top of file
  --> backend/server.py:17:1
   |
15 | from pydantic import BaseModel, Field, ConfigDict, EmailStr
16 | from typing import Optional
17 | from datetime import datetime, timezone
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
18 | import uuid
19 | import time
   |

E402 Module level import not at top of file
  --> backend/server.py:18:1
   |
16 | from typing import Optional
17 | from datetime import datetime, timezone
18 | import uuid
   | ^^^^^^^^^^^
19 | import time
20 | from telegram import Bot, Update, InlineKeyboardButton, InlineKeyboardMarkup, BotCommand, MenuButtonCommands
   |

E402 Module level import not at top of file
  --> backend/server.py:19:1
   |
17 | from datetime import datetime, timezone
18 | import uuid
19 | import time
   | ^^^^^^^^^^^
20 | from telegram import Bot, Update, InlineKeyboardButton, InlineKeyboardMarkup, BotCommand, MenuButtonCommands
21 | from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes, MessageHandler, filters, ConversationHandler
   |

E402 Module level import not at top of file
  --> backend/server.py:20:1
   |
18 | import uuid
19 | import time
20 | from telegram import Bot, Update, InlineKeyboardButton, InlineKeyboardMarkup, BotCommand, MenuButtonCommands
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
21 | from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes, MessageHandler, filters, ConversationHandler
22 | import asyncio
   |

E402 Module level import not at top of file
  --> backend/server.py:21:1
   |
19 | import time
20 | from telegram import Bot, Update, InlineKeyboardButton, InlineKeyboardMarkup, BotCommand, MenuButtonCommands
21 | from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes, MessageHandler, filters, ConversationHandler
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 | import asyncio
23 | import warnings
   |

E402 Module level import not at top of file
  --> backend/server.py:22:1
   |
20 | from telegram import Bot, Update, InlineKeyboardButton, InlineKeyboardMarkup, BotCommand, MenuButtonCommands
21 | from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes, MessageHandler, filters, ConversationHandler
22 | import asyncio
   | ^^^^^^^^^^^^^^
23 | import warnings
   |

E402 Module level import not at top of file
  --> backend/server.py:23:1
   |
21 | from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes, MessageHandler, filters, ConversationHandler
22 | import asyncio
23 | import warnings
   | ^^^^^^^^^^^^^^^
24 |
25 | # Suppress PTBUserWarning about per_message settings (expected behavior)
   |

E402 Module level import not at top of file
  --> backend/server.py:39:1
   |
38 |   # API Services
39 | / from services.api_services import (
40 | |     check_shipstation_balance
41 | | )
   | |_^
42 |
43 |   # Business Logic Services
   |

E402 Module level import not at top of file
  --> backend/server.py:46:1
   |
45 |   # Common handlers (start, help, faq, button routing)
46 | / from handlers.common_handlers import (
47 | |     start_command,
48 | |     help_command,
49 | |     button_callback,
50 | |     mark_message_as_selected,
51 | |     safe_telegram_call
52 | | )
   | |_^
53 |
54 |   # Admin handlers
   |

E402 Module level import not at top of file
  --> backend/server.py:55:1
   |
54 |   # Admin handlers
55 | / from handlers.admin_handlers import (
56 | |     notify_admin_error
57 | | )
   | |_^
58 |
59 |   # Webhook handlers
   |

E402 Module level import not at top of file
  --> backend/server.py:66:1
   |
65 |   # Payment handlers
66 | / from handlers.payment_handlers import (
67 | |     my_balance_command as handler_my_balance_command,
68 | | )
   | |_^
69 |
70 |   # Template handlers  
   |

E402 Module level import not at top of file
  --> backend/server.py:71:1
   |
70 |   # Template handlers  
71 | / from handlers.template_handlers import (
72 | |     my_templates_menu as handler_my_templates_menu,
73 | |     view_template as handler_view_template,
74 | |     use_template as handler_use_template,
75 | |     confirm_delete_template as handler_confirm_delete_template,
76 | |     rename_template_start as handler_rename_template_start,
77 | |     rename_template_save as handler_rename_template_save,
78 | | )
   | |_^
79 |
80 |   # Order flow - cancellation handlers
   |

E402 Module level import not at top of file
  --> backend/server.py:81:1
   |
80 |   # Order flow - cancellation handlers
81 | / from handlers.order_flow.cancellation import (
82 | |     cancel_order as handler_cancel_order,
83 | |     confirm_cancel_order as handler_confirm_cancel_order,
84 | | )
   | |_^
85 |
86 |   # Order flow - entry point handlers
   |

E402 Module level import not at top of file
  --> backend/server.py:87:1
   |
86 |   # Order flow - entry point handlers
87 | / from handlers.order_flow.entry_points import (
88 | |     new_order_start as handler_new_order_start,
89 | |     start_order_with_template as handler_start_order_with_template,
90 | | )
   | |_^
91 |
92 |   # Order flow - confirmation handlers
   |

E402 Module level import not at top of file
  --> backend/server.py:93:1
   |
92 |   # Order flow - confirmation handlers
93 | / from handlers.order_flow.confirmation import (
94 | |     show_data_confirmation as handler_show_data_confirmation,
95 | | )
   | |_^
96 |
97 |   # Order handlers (shipping rates, carrier selection)
   |

E402 Module level import not at top of file
   --> backend/server.py:98:1
    |
 97 |   # Order handlers (shipping rates, carrier selection)
 98 | / from handlers.order_handlers import (
 99 | |     display_shipping_rates as handler_display_shipping_rates,
100 | |     select_carrier as handler_select_carrier,
101 | | )
    | |_^
102 |
103 |   # Template save handlers
    |

E402 Module level import not at top of file
   --> backend/server.py:104:1
    |
103 |   # Template save handlers
104 | / from handlers.order_flow.template_save import (
105 | |     save_template_name as handler_save_template_name,
106 | |     handle_template_update as handler_handle_template_update,
107 | | )
    | |_^
108 |
109 |   # Utility functions (Phase 4 refactoring - gradually moving from server.py)
    |

E402 Module level import not at top of file
   --> backend/server.py:112:1
    |
110 |   # Note: These are still defined in server.py for backward compatibility
111 |   # TODO: Update all imports to use utils modules and remove duplicates
112 | / from utils.telegram_utils import (
113 | |     is_button_click_allowed as util_is_button_click_allowed,
114 | |     generate_random_phone as util_generate_random_phone,
115 | |     sanitize_string as util_sanitize_string,
116 | |     generate_thank_you_message as util_generate_thank_you_message
117 | | )
    | |_^
118 |   from utils.session_utils import (
119 |       save_to_session as util_save_to_session,
    |

E402 Module level import not at top of file
   --> backend/server.py:118:1
    |
116 |       generate_thank_you_message as util_generate_thank_you_message
117 |   )
118 | / from utils.session_utils import (
119 | |     save_to_session as util_save_to_session,
120 | |     handle_critical_api_error as util_handle_critical_api_error,
121 | |     handle_step_error as util_handle_step_error
122 | | )
    | |_^
123 |   from utils.settings_cache import (
124 |       clear_settings_cache as util_clear_settings_cache
    |

E402 Module level import not at top of file
   --> backend/server.py:123:1
    |
121 |       handle_step_error as util_handle_step_error
122 |   )
123 | / from utils.settings_cache import (
124 | |     clear_settings_cache as util_clear_settings_cache
125 | | )
    | |_^
126 |
127 |   # MIGRATED: Profiled DB operations moved to utils.db_operations
    |

E402 Module level import not at top of file
   --> backend/server.py:128:1
    |
127 |   # MIGRATED: Profiled DB operations moved to utils.db_operations
128 | / from utils.db_operations import (
129 | |     delete_template
130 | | )
    | |_^
131 |
132 |   # Debug logging removed - was causing startup issues
    |

E402 Module level import not at top of file
   --> backend/server.py:160:1
    |
159 | # Initialize Session Manager for state management
160 | from session_manager import SessionManager
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
161 | session_manager = SessionManager(db)
    |

E402 Module level import not at top of file
   --> backend/server.py:164:1
    |
163 | # Initialize Repository Manager for data access layer
164 | from repositories import init_repositories, get_repositories
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
165 | repository_manager = init_repositories(db)
166 | print("ðŸ“¦ Repository Manager initialized successfully")
    |

E402 Module level import not at top of file
   --> backend/server.py:176:1
    |
174 | # API CONFIGURATION (Refactored with APIConfigManager)
175 | # ============================================================
176 | from utils.api_config import init_api_config
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
177 |
178 | # Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ API Config Manager
    |

E402 Module level import not at top of file
   --> backend/server.py:200:1
    |
198 |   # TELEGRAM BOT CONFIGURATION (Refactored)
199 |   # ============================================================
200 | / from utils.bot_config import (
201 | |     get_bot_config,
202 | |     get_bot_token,
203 | |     get_bot_username,
204 | |     is_webhook_mode,
205 | |     is_production_environment
206 | | )
    | |_^
207 |
208 |   # ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ Ð±Ð¾Ñ‚Ð°
    |

E402 Module level import not at top of file
   --> backend/server.py:241:1
    |
239 | # Rate limiting Ð´Ð»Ñ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹ Ð¾Ñ‚ Telegram Ð±Ð°Ð½Ð°
240 | # Telegram API limits: 30 msg/sec per chat, burst of 20
241 | from collections import defaultdict
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
242 |
243 | class RateLimiter:
    |

E402 Module level import not at top of file
   --> backend/server.py:296:1
    |
295 | # ==================== MIDDLEWARE ====================
296 | from middleware.logging import RequestLoggingMiddleware
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
297 | from middleware.rate_limiting import RateLimitMiddleware
    |

E402 Module level import not at top of file
   --> backend/server.py:297:1
    |
295 | # ==================== MIDDLEWARE ====================
296 | from middleware.logging import RequestLoggingMiddleware
297 | from middleware.rate_limiting import RateLimitMiddleware
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
298 |
299 | # Add middleware (order matters - first added = last executed)
    |

E402 Module level import not at top of file
   --> backend/server.py:381:1
    |
380 | # Error handling middleware (Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÐµÑ€Ð²Ñ‹Ð¼!)
381 | from middleware.error_handler_middleware import error_handler_middleware
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
382 | app.middleware("http")(error_handler_middleware)
    |

E402 Module level import not at top of file
   --> backend/server.py:636:1
    |
635 | # MIGRATED: Use handlers.order_flow.entry_points.order_from_template_list
636 | from handlers.order_flow.entry_points import order_from_template_list
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |

E741 Ambiguous variable name: `l`
   --> backend/services/admin/system_admin_service.py:281:35
    |
279 |                 # Filter by level if specified
280 |                 if level and level != "ALL":
281 |                     logs = [l for l in logs if level in l]
    |                                   ^
282 |                 
283 |                 return {
    |

E722 Do not use bare `except`
   --> backend/services/payment_gateway.py:285:17
    |
283 |                 try:
284 |                     invoice.paid_at = datetime.fromisoformat(data['date'])
285 |                 except:
    |                 ^^^^^^
286 |                     invoice.paid_at = datetime.now(timezone.utc)
    |

F841 Local variable `query` is assigned to but never used
  --> backend/services/shipping_service.py:45:5
   |
43 |     from utils.ui_utils import ShippingRatesUI
44 |     
45 |     query = update.callback_query
   |     ^^^^^
46 |     
47 |     # Get user balance
   |
help: Remove assignment to unused variable `query`

F841 Local variable `telegram_id` is assigned to but never used
  --> backend/tests/integration/test_payment_integration.py:27:9
   |
26 |         # Setup: User has sufficient balance
27 |         telegram_id = 123456789
   |         ^^^^^^^^^^^
28 |         amount = 15.50
29 |         user_balance = 100.0
   |
help: Remove assignment to unused variable `telegram_id`

F841 Local variable `telegram_id` is assigned to but never used
  --> backend/tests/integration/test_payment_integration.py:60:9
   |
58 |         from services.payment_service import validate_payment_amount
59 |         
60 |         telegram_id = 123456789
   |         ^^^^^^^^^^^
61 |         amount = 150.0  # More than balance
62 |         user_balance = 100.0
   |
help: Remove assignment to unused variable `telegram_id`

F841 Local variable `result` is assigned to but never used
  --> backend/tests/integration/test_webhook_integration.py:91:17
   |
89 |             # Should handle rate limit gracefully
90 |             try:
91 |                 result = await safe_telegram_call(rate_limited_call)
   |                 ^^^^^^
92 |             except RetryAfter:
93 |                 # Expected to raise if retries exhausted
   |
help: Remove assignment to unused variable `result`

E712 Avoid equality comparisons to `True`; use `manager.is_shipstation_configured('test'):` for truth checks
   --> backend/tests/test_api_config.py:116:16
    |
114 |         manager = APIConfigManager()
115 |         
116 |         assert manager.is_shipstation_configured('test') == True
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
117 |         assert manager.is_shipstation_configured('production') == True
118 |         assert manager.is_oxapay_configured() == True
    |
help: Replace with `manager.is_shipstation_configured('test')`

E712 Avoid equality comparisons to `True`; use `manager.is_shipstation_configured('production'):` for truth checks
   --> backend/tests/test_api_config.py:117:16
    |
116 |         assert manager.is_shipstation_configured('test') == True
117 |         assert manager.is_shipstation_configured('production') == True
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
118 |         assert manager.is_oxapay_configured() == True
119 |         assert manager.is_cryptobot_configured() == True
    |
help: Replace with `manager.is_shipstation_configured('production')`

E712 Avoid equality comparisons to `True`; use `manager.is_oxapay_configured():` for truth checks
   --> backend/tests/test_api_config.py:118:16
    |
116 |         assert manager.is_shipstation_configured('test') == True
117 |         assert manager.is_shipstation_configured('production') == True
118 |         assert manager.is_oxapay_configured() == True
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
119 |         assert manager.is_cryptobot_configured() == True
    |
help: Replace with `manager.is_oxapay_configured()`

E712 Avoid equality comparisons to `True`; use `manager.is_cryptobot_configured():` for truth checks
   --> backend/tests/test_api_config.py:119:16
    |
117 |         assert manager.is_shipstation_configured('production') == True
118 |         assert manager.is_oxapay_configured() == True
119 |         assert manager.is_cryptobot_configured() == True
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
120 |     
121 |     @patch.dict(os.environ, {
    |
help: Replace with `manager.is_cryptobot_configured()`

E712 Avoid equality comparisons to `True`; use `status['shipstation']['test_configured']:` for truth checks
   --> backend/tests/test_api_config.py:183:16
    |
182 |         assert status['environment'] == 'test'
183 |         assert status['shipstation']['test_configured'] == True
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
184 |         assert status['shipstation']['prod_configured'] == False
185 |         assert status['oxapay']['configured'] == True
    |
help: Replace with `status['shipstation']['test_configured']`

E712 Avoid equality comparisons to `False`; use `not status['shipstation']['prod_configured']:` for false checks
   --> backend/tests/test_api_config.py:184:16
    |
182 |         assert status['environment'] == 'test'
183 |         assert status['shipstation']['test_configured'] == True
184 |         assert status['shipstation']['prod_configured'] == False
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
185 |         assert status['oxapay']['configured'] == True
    |
help: Replace with `not status['shipstation']['prod_configured']`

E712 Avoid equality comparisons to `True`; use `status['oxapay']['configured']:` for truth checks
   --> backend/tests/test_api_config.py:185:16
    |
183 |         assert status['shipstation']['test_configured'] == True
184 |         assert status['shipstation']['prod_configured'] == False
185 |         assert status['oxapay']['configured'] == True
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
186 |     
187 |     @patch.dict(os.environ, {'SHIPSTATION_API_KEY_TEST': 'cached_key'})
    |
help: Replace with `status['oxapay']['configured']`

E712 Avoid equality comparisons to `True`; use `invoice_paid.is_paid():` for truth checks
  --> backend/tests/test_payment_gateway.py:76:16
   |
74 |         )
75 |         
76 |         assert invoice_paid.is_paid() == True
   |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
77 |         assert invoice_pending.is_paid() == False
   |
help: Replace with `invoice_paid.is_paid()`

E712 Avoid equality comparisons to `False`; use `not invoice_pending.is_paid():` for false checks
  --> backend/tests/test_payment_gateway.py:77:16
   |
76 |         assert invoice_paid.is_paid() == True
77 |         assert invoice_pending.is_paid() == False
   |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Replace with `not invoice_pending.is_paid()`

E712 Avoid equality comparisons to `True`; use `response_data.get('ok'):` for truth checks
   --> backend/tests/test_refactoring_handlers.py:98:20
    |
 96 |             try:
 97 |                 response_data = response.json()
 98 |                 if response_data.get('ok') == True:
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 99 |                     print("   âœ… Webhook returns correct response format")
100 |                 else:
    |
help: Replace with `response_data.get('ok')`

E722 Do not use bare `except`
   --> backend/tests/test_refactoring_handlers.py:102:13
    |
100 |                 else:
101 |                     print(f"   âš ï¸ Webhook response format: {response_data}")
102 |             except:
    |             ^^^^^^
103 |                 print("   âš ï¸ Webhook response not JSON (may be expected)")
104 |         else:
    |

E722 Do not use bare `except`
   --> backend/tests/test_refactoring_handlers.py:109:13
    |
107 |                 error_data = response.json()
108 |                 print(f"      Error: {error_data}")
109 |             except:
    |             ^^^^^^
110 |                 print(f"      Error: {response.text}")
111 |             return False
    |

E722 Do not use bare `except`
   --> backend/tests/test_refactoring_handlers.py:164:13
    |
162 |                 error_data = response.json()
163 |                 print(f"      Error: {error_data}")
164 |             except:
    |             ^^^^^^
165 |                 print(f"      Error: {response.text}")
166 |             return False
    |

F401 `handlers.common_handlers.start_command` imported but unused; consider using `importlib.util.find_spec` to test for availability
   --> backend/tests/test_refactoring_handlers.py:245:50
    |
243 |             sys.path.append('/app/backend')
244 |             
245 |             from handlers.common_handlers import start_command, help_command, faq_command, button_callback
    |                                                  ^^^^^^^^^^^^^
246 |             print("      common_handlers functions: âœ…")
    |
help: Remove unused import

F401 `handlers.common_handlers.help_command` imported but unused; consider using `importlib.util.find_spec` to test for availability
   --> backend/tests/test_refactoring_handlers.py:245:65
    |
243 |             sys.path.append('/app/backend')
244 |             
245 |             from handlers.common_handlers import start_command, help_command, faq_command, button_callback
    |                                                                 ^^^^^^^^^^^^
246 |             print("      common_handlers functions: âœ…")
    |
help: Remove unused import

F401 `handlers.common_handlers.faq_command` imported but unused; consider using `importlib.util.find_spec` to test for availability
   --> backend/tests/test_refactoring_handlers.py:245:79
    |
243 |             sys.path.append('/app/backend')
244 |             
245 |             from handlers.common_handlers import start_command, help_command, faq_command, button_callback
    |                                                                               ^^^^^^^^^^^
246 |             print("      common_handlers functions: âœ…")
    |
help: Remove unused import

F401 `handlers.common_handlers.button_callback` imported but unused; consider using `importlib.util.find_spec` to test for availability
   --> backend/tests/test_refactoring_handlers.py:245:92
    |
243 |             sys.path.append('/app/backend')
244 |             
245 |             from handlers.common_handlers import start_command, help_command, faq_command, button_callback
    |                                                                                            ^^^^^^^^^^^^^^^
246 |             print("      common_handlers functions: âœ…")
    |
help: Remove unused import

F401 `handlers.admin_handlers.verify_admin_key` imported but unused; consider using `importlib.util.find_spec` to test for availability
   --> backend/tests/test_refactoring_handlers.py:248:49
    |
246 |             print("      common_handlers functions: âœ…")
247 |             
248 |             from handlers.admin_handlers import verify_admin_key, notify_admin_error
    |                                                 ^^^^^^^^^^^^^^^^
249 |             print("      admin_handlers functions: âœ…")
    |
help: Remove unused import

F401 `handlers.admin_handlers.notify_admin_error` imported but unused; consider using `importlib.util.find_spec` to test for availability
   --> backend/tests/test_refactoring_handlers.py:248:67
    |
246 |             print("      common_handlers functions: âœ…")
247 |             
248 |             from handlers.admin_handlers import verify_admin_key, notify_admin_error
    |                                                                   ^^^^^^^^^^^^^^^^^^
249 |             print("      admin_handlers functions: âœ…")
    |
help: Remove unused import

E712 Avoid equality comparisons to `True`; use `result:` for truth checks
  --> backend/tests/test_repositories.py:66:16
   |
64 |         result = await user_repo.update_balance(12345, 50.0, operation="add")
65 |         
66 |         assert result == True
   |                ^^^^^^^^^^^^^^
67 |         
68 |         # ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‡Ñ‚Ð¾ Ð²Ñ‹Ð·Ð²Ð°Ð½ update_one Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸
   |
help: Replace with `result`

E712 Avoid equality comparisons to `True`; use `result:` for truth checks
  --> backend/tests/test_repositories.py:80:16
   |
78 |         result = await user_repo.update_balance(12345, 30.0, operation="subtract")
79 |         
80 |         assert result == True
   |                ^^^^^^^^^^^^^^
81 |         
82 |         call_args = user_repo.collection.update_one.call_args
   |
help: Replace with `result`

E712 Avoid equality comparisons to `True`; use `result:` for truth checks
  --> backend/tests/test_repositories.py:95:16
   |
93 |         result = await user_repo.is_admin(12345)
94 |         
95 |         assert result == True
   |                ^^^^^^^^^^^^^^
96 |     
97 |     @pytest.mark.asyncio
   |
help: Replace with `result`

E712 Avoid equality comparisons to `True`; use `result:` for truth checks
   --> backend/tests/test_repositories.py:104:16
    |
102 |         result = await user_repo.block_user(12345)
103 |         
104 |         assert result == True
    |                ^^^^^^^^^^^^^^
    |
help: Replace with `result`

E712 Avoid equality comparisons to `True`; use `result:` for truth checks
   --> backend/tests/test_repositories.py:160:16
    |
158 |         result = await order_repo.update_status("ORDER123", "completed", notes="Done")
159 |         
160 |         assert result == True
    |                ^^^^^^^^^^^^^^
161 |         
162 |         call_args = order_repo.collection.update_one.call_args
    |
help: Replace with `result`

E712 Avoid equality comparisons to `True`; use `result:` for truth checks
   --> backend/tests/test_repositories.py:178:16
    |
176 |         )
177 |         
178 |         assert result == True
    |                ^^^^^^^^^^^^^^
179 |         
180 |         call_args = order_repo.collection.update_one.call_args
    |
help: Replace with `result`

E712 Avoid equality comparisons to `True`; use `result:` for truth checks
   --> backend/tests/test_repositories.py:195:16
    |
193 |         )
194 |         
195 |         assert result == True
    |                ^^^^^^^^^^^^^^
    |
help: Replace with `result`

E402 Module level import not at top of file
  --> backend/tests/test_session_manager.py:15:1
   |
14 | # Import module to test
15 | import sys
   | ^^^^^^^^^^
16 | sys.path.insert(0, '/app/backend')
17 | from session_manager import SessionManager
   |

E402 Module level import not at top of file
  --> backend/tests/test_session_manager.py:17:1
   |
15 | import sys
16 | sys.path.insert(0, '/app/backend')
17 | from session_manager import SessionManager
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

F841 Local variable `legacy_token` is assigned to but never used
  --> backend/utils/bot_config.py:44:9
   |
43 |         # Legacy Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° (Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾Ð¹ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸)
44 |         legacy_token = os.environ.get('TELEGRAM_BOT_TOKEN', '')
   |         ^^^^^^^^^^^^
45 |         
46 |         # Validate configuration
   |
help: Remove assignment to unused variable `legacy_token`

F841 Local variable `last_error` is assigned to but never used
   --> backend/utils/retry_utils.py:152:13
    |
151 |         except Exception as e:
152 |             last_error = e
    |             ^^^^^^^^^^
153 |             logger.warning(f"âš ï¸ Attempt {attempt}/{max_attempts} failed: {operation_name} - {str(e)}")
    |
help: Remove assignment to unused variable `last_error`

Found 162 errors (6 fixed, 156 remaining).
No fixes available (26 hidden fixes can be enabled with the `--unsafe-fixes` option). Ð¸ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð¾ÑÑ‚Ð°Ð²ÑˆÐ¸ÐµÑÑ Ð¾ÑˆÐ¸Ð±ÐºÐ¸.
 Future Tasks:
    - Ð’Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ðµ ÐºÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð½Ð° Redis.
    - Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ (JSON).
    - Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ CI/CD Ð¿Ð°Ð¹Ð¿Ð»Ð°Ð¹Ð½Ð°.

**Completed work in this session**
- **Ð£ÑÑ‚Ñ€Ð°Ð½ÐµÐ½ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚ Polling**: Ð ÐµÑˆÐµÐ½Ð° Ñ„ÑƒÐ½Ð´Ð°Ð¼ÐµÐ½Ñ‚Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ñ , Ð²Ñ‹Ð·Ð²Ð°Ð½Ð½Ð°Ñ Ñ„Ð»Ð°Ð³Ð¾Ð¼  Ð² uvicorn Ð¸, Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾, Ð¾Ñ‚Ð¾Ð·Ð²Ð°Ð½Ð½Ñ‹Ð¼ Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð¼. Ð‘Ð¾Ñ‚ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ.
- **Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° API ÐºÐ»ÑŽÑ‡Ð°**: Ð ÐµÑˆÐµÐ½Ð° ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ñ ÐºÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Ð¼Ð¾Ð´ÑƒÐ»Ñ Ð¸ Ð¿Ð¾Ñ€ÑÐ´ÐºÐ¾Ð¼ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð°, Ð¸Ð·-Ð·Ð° ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¹ API ÐºÐ»ÑŽÑ‡ ShipStation Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°Ð»ÑÑ. Ð›Ð¾Ð³Ð¸ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð±Ñ‹Ð»Ð° Ð¿ÐµÑ€ÐµÐ½ÐµÑÐµÐ½Ð° Ð²Ð½ÑƒÑ‚Ñ€ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹.
- **ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½Ð° Sandbox API**: ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ API-ÐºÐ»ÑŽÑ‡ÐµÐ¹ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½ Ð½Ð° TEST -> PROD, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð·Ð°ÐºÐ°Ð·Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ð»Ð¸ÑÑŒ Ð² Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¼ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ð¸.
- **Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ„Ð»Ð¾Ñƒ**: Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð° Ð´Ð»Ð¸Ð½Ð½Ð°Ñ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ° , , , , Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»Ð¸Ð»Ð¾ Ð´Ð¾Ð¹Ñ‚Ð¸ Ð´Ð¾ ÑˆÐ°Ð³Ð° Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð².
- **Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð° Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¸ ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð²**: Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€ÑƒÑŽÑ‚ÑÑ Ð¿Ð¾ Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹Ð¼ ÑÐµÑ€Ð²Ð¸ÑÐ°Ð¼ (USPS, FedEx, UPS) Ð¸ ÑÐ¾Ñ€Ñ‚Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ (Ð¿Ð¾ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð·Ñ‡Ð¸ÐºÑƒ, Ð·Ð°Ñ‚ÐµÐ¼ Ð¿Ð¾ Ñ†ÐµÐ½Ðµ).
- **Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° ÑÐºÑ€Ñ‹Ñ‚Ð°Ñ Ð½Ð°Ñ†ÐµÐ½ÐºÐ°**: Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð° Ð»Ð¾Ð³Ð¸ÐºÐ° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ 0 Ðº ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð»ÐµÐ¹Ð±Ð»Ð°.
- **Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½ UX ÐºÐ½Ð¾Ð¿Ð¾Ðº**: Ð£Ð±Ñ€Ð°Ð½Ð¾ Ð´ÑƒÐ±Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð¸ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ ÐºÐ½Ð¾Ð¿Ð¾Ðº Ð¿Ð¾ÑÐ»Ðµ Ð¸Ñ… Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ.

**Earlier issues found/mentioned but not fixed**
   - **Ð›Ð¸Ð½Ñ‚Ð¸Ð½Ð³-Ð¾ÑˆÐ¸Ð±ÐºÐ¸**: ÐžÐºÐ¾Ð»Ð¾ 100 Ð¾ÑˆÐ¸Ð±Ð¾Ðº , Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð±Ñ‹Ð»Ð¾ Ð¾Ñ‚Ð»Ð¾Ð¶ÐµÐ½Ð¾.

**Known issue recurrence from previous fork**
  - ÐÐµÑ‚.

**Code Architecture**


**Key Technical Concepts**
- Python Module Caching & Import Order
- Telegram Bot  & 
-  Ð¸ ÐµÐ³Ð¾ Ð²Ð»Ð¸ÑÐ½Ð¸Ðµ Ð½Ð° polling-Ð±Ð¾Ñ‚Ð¾Ð²
- ÐžÑ‚Ð»Ð°Ð´ÐºÐ° API Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² (Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚, Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ, ÐºÐ»ÑŽÑ‡Ð¸)
- Ð Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð»Ð¾Ð³Ð¸ÐºÐ¸ Ð½Ð° ÑÐµÑ€Ð²Ð¸ÑÑ‹ Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸

**key DB schema**
  - : Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐµÑÑÐ¸Ð¹ Ð±Ð¾Ñ‚Ð°.

**changes in tech stack**
  - ÐÐµÑ‚.

**All files**
- **Ð¡Ð¾Ð·Ð´Ð°Ð½Ñ‹:**
  - : Ð”Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð², Ð¸Ñ… Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¸ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹.
- **Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ñ‹:**
  - : ÐŸÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½  Ð² Ð½Ð°Ñ‡Ð°Ð»Ð¾ Ñ„Ð°Ð¹Ð»Ð° Ð´Ð»Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ð¹ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ env-Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…. Ð£Ð´Ð°Ð»ÐµÐ½ Ñ„Ð»Ð°Ð³  Ð¸Ð· ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ supervisor.
  - : Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸ ShipStation ( -> ). Ð›Ð¾Ð³Ð¸ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ API-ÐºÐ»ÑŽÑ‡Ð° Ð¿ÐµÑ€ÐµÐ½ÐµÑÐµÐ½Ð° Ð²Ð½ÑƒÑ‚Ñ€ÑŒ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ Ð´Ð»Ñ Ð¾Ð±Ñ…Ð¾Ð´Ð° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ Ñ ÐºÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼. Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ Ð½Ð° TEST-ÐºÐ»ÑŽÑ‡.
  - : ÐœÐ½Ð¾Ð¶ÐµÑÑ‚Ð²Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ð¹ , , , . Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚  Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸.
  - : Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° ÑÐ»Ð¾Ð¶Ð½Ð°Ñ Ð»Ð¾Ð³Ð¸ÐºÐ° Ð´Ð»Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹Ñ… Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð² Ð¸ Ð¸Ñ… ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ¸ (Ð¿Ð¾ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð·Ñ‡Ð¸ÐºÑƒ, Ð·Ð°Ñ‚ÐµÐ¼ Ð¿Ð¾ Ñ†ÐµÐ½Ðµ).
  - : Ð¡Ð¾Ð·Ð´Ð°Ð½ Ð¸ Ð´Ð¾Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ñ‚Ð°Ñ€Ð¸Ñ„Ð°, Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¸ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹.
  - : Ð£Ð´Ð°Ð»ÐµÐ½ Ñ„Ð»Ð°Ð³  Ð´Ð»Ñ .

**Areas that need refactoring**:
- Ð›Ð¾Ð³Ð¸ÐºÐ°  Ð²ÑÐµ ÐµÑ‰Ðµ ÑÐ»Ð¾Ð¶Ð½Ð°. ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ½Ð¾Ð¿Ð¾Ðº Ð¸ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¹ Ñ€Ð°Ð·Ð±Ñ€Ð¾ÑÐ°Ð½Ð° Ð¿Ð¾ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ð¼ Ñ„Ð°Ð¹Ð»Ð°Ð¼, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¸Ð²Ð¾Ð´Ð¸Ñ‚ Ðº Ð¾ÑˆÐ¸Ð±ÐºÐ°Ð¼.

**key api endpoints**
- **ShipStation API V2**:
  - : Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐ¿Ð¸ÑÐºÐ° Ð¿ÐµÑ€ÐµÐ²Ð¾Ð·Ñ‡Ð¸ÐºÐ¾Ð².
  - : Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð².

**Critical Info for New Agent**
- **ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ â„–1 (P0)**: Ð˜ÑÐ¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ½Ð¾Ð¿ÐºÑƒ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹. ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°, ÑÐºÐ¾Ñ€ÐµÐµ Ð²ÑÐµÐ³Ð¾, Ð² Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ Ð¾Ñ‡Ð¸Ñ‰Ð°Ñ‚ÑŒ , Ð° Ð½Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ .
- **ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ â„–2 (P1)**: Ð’Ñ‹ÑÑÐ½Ð¸Ñ‚ÑŒ, Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ð½Ðµ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÑŽÑ‚ÑÑ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹ USPS. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð±Ñ‹Ð»Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð² , Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ, Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ð¾Ð½Ð¸ Ð¾Ñ‚Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ.
- **ÐšÐ•Ð¨Ð˜Ð ÐžÐ’ÐÐÐ˜Ð•**: Ð¥Ð¾Ñ‚Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ ÐºÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹ Python Ñ€ÐµÑˆÐµÐ½Ñ‹, Ð¿Ð¾Ð¼Ð½Ð¸Ñ‚Ðµ Ð¾ ÐºÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ).
- **Ð¯Ð·Ñ‹Ðº**: ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐž Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð¹Ñ‚Ðµ Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼ Ð½Ð° **Ñ€ÑƒÑÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ**.

**documents created in this job**
  - ÐÐµÑ‚.

**Last 5 User Messages and any pending user messages**
 - **User:** Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹ Ðº Ð°Ð¿Ð¸ Ð½Ðµ Ð¾Ð±Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ, Ñ‚Ð°Ðº Ð¶Ðµ Ð¿Ñ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ Ð½Ð° Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð¿Ð¾ÑÐ²Ð»ÑÑ‚ÑŒÑÑ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ñ‡Ñ‚Ð¾ Ð¸Ñ‰ÐµÑ‚ÑÑ ÐºÐ°Ðº Ð² Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ñ€Ð°Ð· - **Status:** IN PROGRESS. ÐšÐ½Ð¾Ð¿ÐºÐ° ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐºÐ°Ðº Ð½Ð°Ð´Ð¾.
 - **User:** ÑŽÑÐ¿Ñ Ð½Ðµ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ - **Status:** IN PROGRESS. Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹ USPS Ð½Ðµ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÑŽÑ‚ÑÑ.
 - **User:** Ð¿Ñ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ Ð½Ð° Ð¿Ð¾ÐºÑƒÐ¿ÐºÑƒ Ñ‚Ð°Ñ€Ð¸Ñ„Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ° - **Status:** RESOLVED. ÐÐ³ÐµÐ½Ñ‚ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð¸Ð» .
 - **User:** Ð½ÐµÑ‚ Ð¼Ð½Ðµ Ð½ÑƒÐ¶Ð½Ñ‹, Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾Ð¿ÑƒÐ»Ñ€ÑÐ½Ñ‹Ðµ Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹, Ð¿Ð¾ Ñ‚Ñ€ÐµÐ¼ ÑÐ»ÑƒÐ¶Ð±Ð°Ð¼ - **Status:** RESOLVED. ÐÐ³ÐµÐ½Ñ‚ Ð²ÐµÑ€Ð½ÑƒÐ» Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ Ð¿Ð¾ Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹Ð¼ Ñ‚Ð°Ñ€Ð¸Ñ„Ð°Ð¼.
 - **User:** Ð½Ðµ Ð¿Ð¾Ð¿Ð¾Ñ€ÑÐ´ÐºÑƒ - **Status:** RESOLVED. ÐÐ³ÐµÐ½Ñ‚ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð¸Ð» ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÑƒ Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð².

**Project Health Check:**
- **Broken:** ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ (Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð²) Ð¸ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… (USPS Ñ‚Ð°Ñ€Ð¸Ñ„Ñ‹) Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚.
- **Mocked:** ÐÐµÑ‚.

**Testing status**
  - Testing agent used after significant changes: NO
  - Troubleshoot agent used after agent stuck in loop: YES
  - Test files created: []
  - Known regressions: ÐÐµÑ‚.

**Credentials to test flow:**
ÐÐµ Ñ‚Ñ€ÐµÐ±ÑƒÑŽÑ‚ÑÑ. Ð’ÑÐµ ÐºÐ»ÑŽÑ‡Ð¸ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ Ð²  Ñ„Ð°Ð¹Ð»Ðµ.

**What agent forgot to execute**
ÐÐ³ÐµÐ½Ñ‚ Ð¾Ñ‚Ð»Ð¾Ð¶Ð¸Ð» Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð»Ð¸Ð½Ñ‚ÐµÑ€Ð°, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÑ„Ð¾ÐºÑƒÑÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ Ð½Ð° ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð±Ð°Ð³Ð°Ñ…, Ð¾ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… ÑÐ¾Ð¾Ð±Ñ‰Ð°Ð» Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ. Ð­Ñ‚Ð¾ Ð±Ñ‹Ð»Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼ Ñ€ÐµÑˆÐµÐ½Ð¸ÐµÐ¼.</analysis>
